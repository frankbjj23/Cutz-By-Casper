"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/assistant/route";
exports.ids = ["app/api/assistant/route"];
exports.modules = {

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "child_process":
/*!********************************!*\
  !*** external "child_process" ***!
  \********************************/
/***/ ((module) => {

module.exports = require("child_process");

/***/ }),

/***/ "crypto":
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("crypto");

/***/ }),

/***/ "events":
/*!*************************!*\
  !*** external "events" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("events");

/***/ }),

/***/ "http":
/*!***********************!*\
  !*** external "http" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("http");

/***/ }),

/***/ "https":
/*!************************!*\
  !*** external "https" ***!
  \************************/
/***/ ((module) => {

module.exports = require("https");

/***/ }),

/***/ "util":
/*!***********************!*\
  !*** external "util" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("util");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fassistant%2Froute&page=%2Fapi%2Fassistant%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fassistant%2Froute.ts&appDir=C%3A%5CUsers%5Cfrank%5CDesktop%5CCutz-By-Casper%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Cfrank%5CDesktop%5CCutz-By-Casper&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!*****************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fassistant%2Froute&page=%2Fapi%2Fassistant%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fassistant%2Froute.ts&appDir=C%3A%5CUsers%5Cfrank%5CDesktop%5CCutz-By-Casper%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Cfrank%5CDesktop%5CCutz-By-Casper&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \*****************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var C_Users_frank_Desktop_Cutz_By_Casper_app_api_assistant_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./app/api/assistant/route.ts */ \"(rsc)/./app/api/assistant/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/assistant/route\",\n        pathname: \"/api/assistant\",\n        filename: \"route\",\n        bundlePath: \"app/api/assistant/route\"\n    },\n    resolvedPagePath: \"C:\\\\Users\\\\frank\\\\Desktop\\\\Cutz-By-Casper\\\\app\\\\api\\\\assistant\\\\route.ts\",\n    nextConfigOutput,\n    userland: C_Users_frank_Desktop_Cutz_By_Casper_app_api_assistant_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks } = routeModule;\nconst originalPathname = \"/api/assistant/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZhc3Npc3RhbnQlMkZyb3V0ZSZwYWdlPSUyRmFwaSUyRmFzc2lzdGFudCUyRnJvdXRlJmFwcFBhdGhzPSZwYWdlUGF0aD1wcml2YXRlLW5leHQtYXBwLWRpciUyRmFwaSUyRmFzc2lzdGFudCUyRnJvdXRlLnRzJmFwcERpcj1DJTNBJTVDVXNlcnMlNUNmcmFuayU1Q0Rlc2t0b3AlNUNDdXR6LUJ5LUNhc3BlciU1Q2FwcCZwYWdlRXh0ZW5zaW9ucz10c3gmcGFnZUV4dGVuc2lvbnM9dHMmcGFnZUV4dGVuc2lvbnM9anN4JnBhZ2VFeHRlbnNpb25zPWpzJnJvb3REaXI9QyUzQSU1Q1VzZXJzJTVDZnJhbmslNUNEZXNrdG9wJTVDQ3V0ei1CeS1DYXNwZXImaXNEZXY9dHJ1ZSZ0c2NvbmZpZ1BhdGg9dHNjb25maWcuanNvbiZiYXNlUGF0aD0mYXNzZXRQcmVmaXg9Jm5leHRDb25maWdPdXRwdXQ9JnByZWZlcnJlZFJlZ2lvbj0mbWlkZGxld2FyZUNvbmZpZz1lMzAlM0QhIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7OztBQUFzRztBQUN2QztBQUNjO0FBQ3dCO0FBQ3JHO0FBQ0E7QUFDQTtBQUNBLHdCQUF3QixnSEFBbUI7QUFDM0M7QUFDQSxjQUFjLHlFQUFTO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxZQUFZO0FBQ1osQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBLFFBQVEsaUVBQWlFO0FBQ3pFO0FBQ0E7QUFDQSxXQUFXLDRFQUFXO0FBQ3RCO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDdUg7O0FBRXZIIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vY3V0ei1ieS1jYXNwZXIvP2I3YTYiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQXBwUm91dGVSb3V0ZU1vZHVsZSB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1tb2R1bGVzL2FwcC1yb3V0ZS9tb2R1bGUuY29tcGlsZWRcIjtcbmltcG9ydCB7IFJvdXRlS2luZCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1raW5kXCI7XG5pbXBvcnQgeyBwYXRjaEZldGNoIGFzIF9wYXRjaEZldGNoIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvbGliL3BhdGNoLWZldGNoXCI7XG5pbXBvcnQgKiBhcyB1c2VybGFuZCBmcm9tIFwiQzpcXFxcVXNlcnNcXFxcZnJhbmtcXFxcRGVza3RvcFxcXFxDdXR6LUJ5LUNhc3BlclxcXFxhcHBcXFxcYXBpXFxcXGFzc2lzdGFudFxcXFxyb3V0ZS50c1wiO1xuLy8gV2UgaW5qZWN0IHRoZSBuZXh0Q29uZmlnT3V0cHV0IGhlcmUgc28gdGhhdCB3ZSBjYW4gdXNlIHRoZW0gaW4gdGhlIHJvdXRlXG4vLyBtb2R1bGUuXG5jb25zdCBuZXh0Q29uZmlnT3V0cHV0ID0gXCJcIlxuY29uc3Qgcm91dGVNb2R1bGUgPSBuZXcgQXBwUm91dGVSb3V0ZU1vZHVsZSh7XG4gICAgZGVmaW5pdGlvbjoge1xuICAgICAgICBraW5kOiBSb3V0ZUtpbmQuQVBQX1JPVVRFLFxuICAgICAgICBwYWdlOiBcIi9hcGkvYXNzaXN0YW50L3JvdXRlXCIsXG4gICAgICAgIHBhdGhuYW1lOiBcIi9hcGkvYXNzaXN0YW50XCIsXG4gICAgICAgIGZpbGVuYW1lOiBcInJvdXRlXCIsXG4gICAgICAgIGJ1bmRsZVBhdGg6IFwiYXBwL2FwaS9hc3Npc3RhbnQvcm91dGVcIlxuICAgIH0sXG4gICAgcmVzb2x2ZWRQYWdlUGF0aDogXCJDOlxcXFxVc2Vyc1xcXFxmcmFua1xcXFxEZXNrdG9wXFxcXEN1dHotQnktQ2FzcGVyXFxcXGFwcFxcXFxhcGlcXFxcYXNzaXN0YW50XFxcXHJvdXRlLnRzXCIsXG4gICAgbmV4dENvbmZpZ091dHB1dCxcbiAgICB1c2VybGFuZFxufSk7XG4vLyBQdWxsIG91dCB0aGUgZXhwb3J0cyB0aGF0IHdlIG5lZWQgdG8gZXhwb3NlIGZyb20gdGhlIG1vZHVsZS4gVGhpcyBzaG91bGRcbi8vIGJlIGVsaW1pbmF0ZWQgd2hlbiB3ZSd2ZSBtb3ZlZCB0aGUgb3RoZXIgcm91dGVzIHRvIHRoZSBuZXcgZm9ybWF0LiBUaGVzZVxuLy8gYXJlIHVzZWQgdG8gaG9vayBpbnRvIHRoZSByb3V0ZS5cbmNvbnN0IHsgcmVxdWVzdEFzeW5jU3RvcmFnZSwgc3RhdGljR2VuZXJhdGlvbkFzeW5jU3RvcmFnZSwgc2VydmVySG9va3MgfSA9IHJvdXRlTW9kdWxlO1xuY29uc3Qgb3JpZ2luYWxQYXRobmFtZSA9IFwiL2FwaS9hc3Npc3RhbnQvcm91dGVcIjtcbmZ1bmN0aW9uIHBhdGNoRmV0Y2goKSB7XG4gICAgcmV0dXJuIF9wYXRjaEZldGNoKHtcbiAgICAgICAgc2VydmVySG9va3MsXG4gICAgICAgIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2VcbiAgICB9KTtcbn1cbmV4cG9ydCB7IHJvdXRlTW9kdWxlLCByZXF1ZXN0QXN5bmNTdG9yYWdlLCBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlLCBzZXJ2ZXJIb29rcywgb3JpZ2luYWxQYXRobmFtZSwgcGF0Y2hGZXRjaCwgIH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWFwcC1yb3V0ZS5qcy5tYXAiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fassistant%2Froute&page=%2Fapi%2Fassistant%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fassistant%2Froute.ts&appDir=C%3A%5CUsers%5Cfrank%5CDesktop%5CCutz-By-Casper%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Cfrank%5CDesktop%5CCutz-By-Casper&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./app/api/assistant/route.ts":
/*!************************************!*\
  !*** ./app/api/assistant/route.ts ***!
  \************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   POST: () => (/* binding */ POST),\n/* harmony export */   dynamic: () => (/* binding */ dynamic),\n/* harmony export */   runtime: () => (/* binding */ runtime)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n/* harmony import */ var zod__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! zod */ \"(rsc)/./node_modules/zod/v3/types.js\");\n/* harmony import */ var _lib_server_assistant__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/server/assistant */ \"(rsc)/./lib/server/assistant.ts\");\n\n\n\nconst runtime = \"nodejs\";\nconst dynamic = \"force-dynamic\";\nconst requestSchema = zod__WEBPACK_IMPORTED_MODULE_2__.object({\n    messages: zod__WEBPACK_IMPORTED_MODULE_2__.array(zod__WEBPACK_IMPORTED_MODULE_2__.object({\n        role: zod__WEBPACK_IMPORTED_MODULE_2__[\"enum\"]([\n            \"user\",\n            \"assistant\"\n        ]),\n        content: zod__WEBPACK_IMPORTED_MODULE_2__.string().min(1)\n    })),\n    localeTimeZone: zod__WEBPACK_IMPORTED_MODULE_2__.string().optional()\n});\nconst RATE_WINDOW_MS = 60000;\nconst RATE_MAX = 25;\nconst rateState = new Map();\nconst getClientIp = (request)=>{\n    const forwarded = request.headers.get(\"x-forwarded-for\");\n    if (forwarded) {\n        return forwarded.split(\",\")[0].trim();\n    }\n    return request.headers.get(\"x-real-ip\") ?? \"unknown\";\n};\nconst rateLimit = (request)=>{\n    const ip = getClientIp(request);\n    const now = Date.now();\n    const existing = rateState.get(ip);\n    if (!existing || existing.resetAt <= now) {\n        rateState.set(ip, {\n            count: 1,\n            resetAt: now + RATE_WINDOW_MS\n        });\n        return null;\n    }\n    if (existing.count >= RATE_MAX) {\n        return existing.resetAt - now;\n    }\n    existing.count += 1;\n    return null;\n};\nasync function POST(request) {\n    try {\n        const rate = rateLimit(request);\n        if (rate !== null) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Too many requests. Please wait a moment.\"\n            }, {\n                status: 429\n            });\n        }\n        const body = await request.json();\n        const parsed = requestSchema.safeParse(body);\n        if (!parsed.success) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Invalid payload\"\n            }, {\n                status: 400\n            });\n        }\n        if (!process.env.OPENAI_API_KEY) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                replyText: \"AI Secretary isn’t configured yet. The site owner needs to set OPENAI_API_KEY. For now, please use the normal booking page or call/text Casper.\",\n                actions: [\n                    {\n                        type: \"open_booking\",\n                        label: \"Book Now\",\n                        url: \"/book\"\n                    },\n                    {\n                        type: \"call\",\n                        label: \"Call\",\n                        url: \"tel:+12018896440\"\n                    },\n                    {\n                        type: \"text\",\n                        label: \"Text\",\n                        url: \"sms:+12018896440\"\n                    }\n                ]\n            }, {\n                status: 200\n            });\n        }\n        const { replyText, actions } = await (0,_lib_server_assistant__WEBPACK_IMPORTED_MODULE_1__.generateAssistantReply)(parsed.data.messages);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            replyText,\n            actions\n        }, {\n            status: 200\n        });\n    } catch (error) {\n        const detail = error instanceof Error ? error.message : typeof error === \"string\" ? error : JSON.stringify(error);\n        console.error(\"assistant error\", detail);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: true,\n            message: \"Assistant failed\",\n            detail: detail || \"Assistant unavailable.\"\n        }, {\n            status: 500\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QU9qQixVQUFVLFdBQ2ZBLFFBQ0FrQixLQUFLQyxTQUFTLENBQUNuQjtRQUN2Qm9CLFFBQVFwQixLQUFLLENBQUMsbUJBQW1CZTtRQUNqQyxPQUFPckQscURBQVlBLENBQUNxQyxJQUFJLENBQ3RCO1lBQ0VDLE9BQU87WUFDUGlCLFNBQVM7WUFDVEYsUUFBUUEsVUFBVTtRQUNwQixHQUNBO1lBQUVkLFFBQVE7UUFBSTtJQUVsQjtBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vY3V0ei1ieS1jYXNwZXIvLi9hcHAvYXBpL2Fzc2lzdGFudC9yb3V0ZS50cz8xNWVlIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE5leHRSZXNwb25zZSB9IGZyb20gXCJuZXh0L3NlcnZlclwiO1xuaW1wb3J0IHsgeiB9IGZyb20gXCJ6b2RcIjtcbmltcG9ydCB7IGdlbmVyYXRlQXNzaXN0YW50UmVwbHkgfSBmcm9tIFwiQC9saWIvc2VydmVyL2Fzc2lzdGFudFwiO1xuXG5leHBvcnQgY29uc3QgcnVudGltZSA9IFwibm9kZWpzXCI7XG5leHBvcnQgY29uc3QgZHluYW1pYyA9IFwiZm9yY2UtZHluYW1pY1wiO1xuXG5jb25zdCByZXF1ZXN0U2NoZW1hID0gei5vYmplY3Qoe1xuICBtZXNzYWdlczogei5hcnJheShcbiAgICB6Lm9iamVjdCh7XG4gICAgICByb2xlOiB6LmVudW0oW1widXNlclwiLCBcImFzc2lzdGFudFwiXSksXG4gICAgICBjb250ZW50OiB6LnN0cmluZygpLm1pbigxKSxcbiAgICB9KVxuICApLFxuICBsb2NhbGVUaW1lWm9uZTogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxufSk7XG5cbmNvbnN0IFJBVEVfV0lORE9XX01TID0gNjBfMDAwO1xuY29uc3QgUkFURV9NQVggPSAyNTtcbmNvbnN0IHJhdGVTdGF0ZSA9IG5ldyBNYXA8c3RyaW5nLCB7IGNvdW50OiBudW1iZXI7IHJlc2V0QXQ6IG51bWJlciB9PigpO1xuXG5jb25zdCBnZXRDbGllbnRJcCA9IChyZXF1ZXN0OiBSZXF1ZXN0KSA9PiB7XG4gIGNvbnN0IGZvcndhcmRlZCA9IHJlcXVlc3QuaGVhZGVycy5nZXQoXCJ4LWZvcndhcmRlZC1mb3JcIik7XG4gIGlmIChmb3J3YXJkZWQpIHtcbiAgICByZXR1cm4gZm9yd2FyZGVkLnNwbGl0KFwiLFwiKVswXS50cmltKCk7XG4gIH1cbiAgcmV0dXJuIHJlcXVlc3QuaGVhZGVycy5nZXQoXCJ4LXJlYWwtaXBcIikgPz8gXCJ1bmtub3duXCI7XG59O1xuXG5jb25zdCByYXRlTGltaXQgPSAocmVxdWVzdDogUmVxdWVzdCkgPT4ge1xuICBjb25zdCBpcCA9IGdldENsaWVudElwKHJlcXVlc3QpO1xuICBjb25zdCBub3cgPSBEYXRlLm5vdygpO1xuICBjb25zdCBleGlzdGluZyA9IHJhdGVTdGF0ZS5nZXQoaXApO1xuICBpZiAoIWV4aXN0aW5nIHx8IGV4aXN0aW5nLnJlc2V0QXQgPD0gbm93KSB7XG4gICAgcmF0ZVN0YXRlLnNldChpcCwgeyBjb3VudDogMSwgcmVzZXRBdDogbm93ICsgUkFURV9XSU5ET1dfTVMgfSk7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cbiAgaWYgKGV4aXN0aW5nLmNvdW50ID49IFJBVEVfTUFYKSB7XG4gICAgcmV0dXJuIGV4aXN0aW5nLnJlc2V0QXQgLSBub3c7XG4gIH1cbiAgZXhpc3RpbmcuY291bnQgKz0gMTtcbiAgcmV0dXJuIG51bGw7XG59O1xuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gUE9TVChyZXF1ZXN0OiBSZXF1ZXN0KSB7XG4gIHRyeSB7XG4gICAgY29uc3QgcmF0ZSA9IHJhdGVMaW1pdChyZXF1ZXN0KTtcbiAgICBpZiAocmF0ZSAhPT0gbnVsbCkge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7IGVycm9yOiBcIlRvbyBtYW55IHJlcXVlc3RzLiBQbGVhc2Ugd2FpdCBhIG1vbWVudC5cIiB9LFxuICAgICAgICB7IHN0YXR1czogNDI5IH1cbiAgICAgICk7XG4gICAgfVxuXG4gICAgY29uc3QgYm9keSA9IGF3YWl0IHJlcXVlc3QuanNvbigpO1xuICAgIGNvbnN0IHBhcnNlZCA9IHJlcXVlc3RTY2hlbWEuc2FmZVBhcnNlKGJvZHkpO1xuICAgIGlmICghcGFyc2VkLnN1Y2Nlc3MpIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IGVycm9yOiBcIkludmFsaWQgcGF5bG9hZFwiIH0sIHsgc3RhdHVzOiA0MDAgfSk7XG4gICAgfVxuXG4gICAgaWYgKCFwcm9jZXNzLmVudi5PUEVOQUlfQVBJX0tFWSkge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7XG4gICAgICAgICAgcmVwbHlUZXh0OlxuICAgICAgICAgICAgXCJBSSBTZWNyZXRhcnkgaXNu4oCZdCBjb25maWd1cmVkIHlldC4gVGhlIHNpdGUgb3duZXIgbmVlZHMgdG8gc2V0IE9QRU5BSV9BUElfS0VZLiBGb3Igbm93LCBwbGVhc2UgdXNlIHRoZSBub3JtYWwgYm9va2luZyBwYWdlIG9yIGNhbGwvdGV4dCBDYXNwZXIuXCIsXG4gICAgICAgICAgYWN0aW9uczogW1xuICAgICAgICAgICAgeyB0eXBlOiBcIm9wZW5fYm9va2luZ1wiLCBsYWJlbDogXCJCb29rIE5vd1wiLCB1cmw6IFwiL2Jvb2tcIiB9LFxuICAgICAgICAgICAgeyB0eXBlOiBcImNhbGxcIiwgbGFiZWw6IFwiQ2FsbFwiLCB1cmw6IFwidGVsOisxMjAxODg5NjQ0MFwiIH0sXG4gICAgICAgICAgICB7IHR5cGU6IFwidGV4dFwiLCBsYWJlbDogXCJUZXh0XCIsIHVybDogXCJzbXM6KzEyMDE4ODk2NDQwXCIgfSxcbiAgICAgICAgICBdLFxuICAgICAgICB9LFxuICAgICAgICB7IHN0YXR1czogMjAwIH1cbiAgICAgICk7XG4gICAgfVxuXG4gICAgY29uc3QgeyByZXBseVRleHQsIGFjdGlvbnMgfSA9IGF3YWl0IGdlbmVyYXRlQXNzaXN0YW50UmVwbHkocGFyc2VkLmRhdGEubWVzc2FnZXMpO1xuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IHJlcGx5VGV4dCwgYWN0aW9ucyB9LCB7IHN0YXR1czogMjAwIH0pO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnN0IGRldGFpbCA9XG4gICAgICBlcnJvciBpbnN0YW5jZW9mIEVycm9yXG4gICAgICAgID8gZXJyb3IubWVzc2FnZVxuICAgICAgICA6IHR5cGVvZiBlcnJvciA9PT0gXCJzdHJpbmdcIlxuICAgICAgICAgID8gZXJyb3JcbiAgICAgICAgICA6IEpTT04uc3RyaW5naWZ5KGVycm9yKTtcbiAgICBjb25zb2xlLmVycm9yKFwiYXNzaXN0YW50IGVycm9yXCIsIGRldGFpbCk7XG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAge1xuICAgICAgICBlcnJvcjogdHJ1ZSxcbiAgICAgICAgbWVzc2FnZTogXCJBc3Npc3RhbnQgZmFpbGVkXCIsXG4gICAgICAgIGRldGFpbDogZGV0YWlsIHx8IFwiQXNzaXN0YW50IHVuYXZhaWxhYmxlLlwiLFxuICAgICAgfSxcbiAgICAgIHsgc3RhdHVzOiA1MDAgfVxuICAgICk7XG4gIH1cbn1cbiJdLCJuYW1lcyI6WyJOZXh0UmVzcG9uc2UiLCJ6IiwiZ2VuZXJhdGVBc3Npc3RhbnRSZXBseSIsInJ1bnRpbWUiLCJkeW5hbWljIiwicmVxdWVzdFNjaGVtYSIsIm9iamVjdCIsIm1lc3NhZ2VzIiwiYXJyYXkiLCJyb2xlIiwiZW51bSIsImNvbnRlbnQiLCJzdHJpbmciLCJtaW4iLCJsb2NhbGVUaW1lWm9uZSIsIm9wdGlvbmFsIiwiUkFURV9XSU5ET1dfTVMiLCJSQVRFX01BWCIsInJhdGVTdGF0ZSIsIk1hcCIsImdldENsaWVudElwIiwicmVxdWVzdCIsImZvcndhcmRlZCIsImhlYWRlcnMiLCJnZXQiLCJzcGxpdCIsInRyaW0iLCJyYXRlTGltaXQiLCJpcCIsIm5vdyIsIkRhdGUiLCJleGlzdGluZyIsInJlc2V0QXQiLCJzZXQiLCJjb3VudCIsIlBPU1QiLCJyYXRlIiwianNvbiIsImVycm9yIiwic3RhdHVzIiwiYm9keSIsInBhcnNlZCIsInNhZmVQYXJzZSIsInN1Y2Nlc3MiLCJwcm9jZXNzIiwiZW52IiwiT1BFTkFJX0FQSV9LRVkiLCJyZXBseVRleHQiLCJhY3Rpb25zIiwidHlwZSIsImxhYmVsIiwidXJsIiwiZGF0YSIsImRldGFpbCIsIkVycm9yIiwibWVzc2FnZSIsIkpTT04iLCJzdHJpbmdpZnkiLCJjb25zb2xlIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./app/api/assistant/route.ts\n");

/***/ }),

/***/ "(rsc)/./lib/availability.ts":
/*!*****************************!*\
  !*** ./lib/availability.ts ***!
  \*****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   generateSlots: () => (/* binding */ generateSlots)\n/* harmony export */ });\n/* harmony import */ var luxon__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! luxon */ \"(rsc)/./node_modules/luxon/build/es6/luxon.mjs\");\n/* harmony import */ var _time__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./time */ \"(rsc)/./lib/time.ts\");\n\n\nconst generateSlots = ({ date, timeZone, workingHours, serviceDurationMinutes, bufferMinutes, appointments })=>{\n    const dayKey = luxon__WEBPACK_IMPORTED_MODULE_1__.DateTime.fromISO(date, {\n        zone: timeZone\n    }).toFormat(\"cccc\");\n    const ranges = workingHours[dayKey] ?? [];\n    const slots = [];\n    const nowLocal = luxon__WEBPACK_IMPORTED_MODULE_1__.DateTime.now().setZone(timeZone);\n    const busyWindows = appointments.map((appt)=>{\n        const start = luxon__WEBPACK_IMPORTED_MODULE_1__.DateTime.fromISO(appt.start_time_utc, {\n            zone: \"utc\"\n        });\n        const end = luxon__WEBPACK_IMPORTED_MODULE_1__.DateTime.fromISO(appt.end_time_utc, {\n            zone: \"utc\"\n        }).plus({\n            minutes: bufferMinutes\n        });\n        return {\n            start,\n            end\n        };\n    });\n    ranges.forEach((range)=>{\n        const rangeStart = (0,_time__WEBPACK_IMPORTED_MODULE_0__.buildLocalDateTime)(date, range.start, timeZone);\n        const rangeEnd = (0,_time__WEBPACK_IMPORTED_MODULE_0__.buildLocalDateTime)(date, range.end, timeZone);\n        let cursor = rangeStart;\n        while(cursor.plus({\n            minutes: serviceDurationMinutes\n        }) <= rangeEnd){\n            const localStart = cursor;\n            const localEnd = cursor.plus({\n                minutes: serviceDurationMinutes\n            });\n            const localEndWithBuffer = localEnd.plus({\n                minutes: bufferMinutes\n            });\n            const utcStart = localStart.toUTC();\n            const utcEnd = localEndWithBuffer.toUTC();\n            const overlaps = busyWindows.some((window)=>utcStart < window.end && utcEnd > window.start);\n            const isFuture = localStart >= nowLocal;\n            if (!overlaps && isFuture) {\n                slots.push({\n                    startTimeLocalISO: localStart.toISO() ?? \"\",\n                    label: localStart.toFormat(\"h:mm a\")\n                });\n            }\n            cursor = cursor.plus({\n                minutes: 15\n            });\n        }\n    });\n    return slots;\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvYXZhaWxhYmlsaXR5LnRzIiwibWFwcGluZ3MiOiI7Ozs7OztBQUFpQztBQUNXO0FBU3JDLE1BQU1FLGdCQUFnQixDQUFDLEVBQzVCQyxJQUFJLEVBQ0pDLFFBQVEsRUFDUkMsWUFBWSxFQUNaQyxzQkFBc0IsRUFDdEJDLGFBQWEsRUFDYkMsWUFBWSxFQVFiO0lBQ0MsTUFBTUMsU0FBU1QsMkNBQVFBLENBQUNVLE9BQU8sQ0FBQ1AsTUFBTTtRQUFFUSxNQUFNUDtJQUFTLEdBQUdRLFFBQVEsQ0FBQztJQUNuRSxNQUFNQyxTQUFTUixZQUFZLENBQUNJLE9BQU8sSUFBSSxFQUFFO0lBQ3pDLE1BQU1LLFFBQXdELEVBQUU7SUFDaEUsTUFBTUMsV0FBV2YsMkNBQVFBLENBQUNnQixHQUFHLEdBQUdDLE9BQU8sQ0FBQ2I7SUFFeEMsTUFBTWMsY0FBY1YsYUFBYVcsR0FBRyxDQUFDLENBQUNDO1FBQ3BDLE1BQU1DLFFBQVFyQiwyQ0FBUUEsQ0FBQ1UsT0FBTyxDQUFDVSxLQUFLRSxjQUFjLEVBQUU7WUFBRVgsTUFBTTtRQUFNO1FBQ2xFLE1BQU1ZLE1BQU12QiwyQ0FBUUEsQ0FBQ1UsT0FBTyxDQUFDVSxLQUFLSSxZQUFZLEVBQUU7WUFBRWIsTUFBTTtRQUFNLEdBQUdjLElBQUksQ0FBQztZQUNwRUMsU0FBU25CO1FBQ1g7UUFDQSxPQUFPO1lBQUVjO1lBQU9FO1FBQUk7SUFDdEI7SUFFQVYsT0FBT2MsT0FBTyxDQUFDLENBQUNDO1FBQ2QsTUFBTUMsYUFBYTVCLHlEQUFrQkEsQ0FBQ0UsTUFBTXlCLE1BQU1QLEtBQUssRUFBRWpCO1FBQ3pELE1BQU0wQixXQUFXN0IseURBQWtCQSxDQUFDRSxNQUFNeUIsTUFBTUwsR0FBRyxFQUFFbkI7UUFDckQsSUFBSTJCLFNBQVNGO1FBRWIsTUFBT0UsT0FBT04sSUFBSSxDQUFDO1lBQUVDLFNBQVNwQjtRQUF1QixNQUFNd0IsU0FBVTtZQUNuRSxNQUFNRSxhQUFhRDtZQUNuQixNQUFNRSxXQUFXRixPQUFPTixJQUFJLENBQUM7Z0JBQUVDLFNBQVNwQjtZQUF1QjtZQUMvRCxNQUFNNEIscUJBQXFCRCxTQUFTUixJQUFJLENBQUM7Z0JBQUVDLFNBQVNuQjtZQUFjO1lBQ2xFLE1BQU00QixXQUFXSCxXQUFXSSxLQUFLO1lBQ2pDLE1BQU1DLFNBQVNILG1CQUFtQkUsS0FBSztZQUN2QyxNQUFNRSxXQUFXcEIsWUFBWXFCLElBQUksQ0FDL0IsQ0FBQ0MsU0FBV0wsV0FBV0ssT0FBT2pCLEdBQUcsSUFBSWMsU0FBU0csT0FBT25CLEtBQUs7WUFFNUQsTUFBTW9CLFdBQVdULGNBQWNqQjtZQUMvQixJQUFJLENBQUN1QixZQUFZRyxVQUFVO2dCQUN6QjNCLE1BQU00QixJQUFJLENBQUM7b0JBQ1RDLG1CQUFtQlgsV0FBV1ksS0FBSyxNQUFNO29CQUN6Q0MsT0FBT2IsV0FBV3BCLFFBQVEsQ0FBQztnQkFDN0I7WUFDRjtZQUNBbUIsU0FBU0EsT0FBT04sSUFBSSxDQUFDO2dCQUFFQyxTQUFTO1lBQUc7UUFDckM7SUFDRjtJQUVBLE9BQU9aO0FBQ1QsRUFBRSIsInNvdXJjZXMiOlsid2VicGFjazovL2N1dHotYnktY2FzcGVyLy4vbGliL2F2YWlsYWJpbGl0eS50cz9lZDc4Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IERhdGVUaW1lIH0gZnJvbSBcImx1eG9uXCI7XG5pbXBvcnQgeyBidWlsZExvY2FsRGF0ZVRpbWUgfSBmcm9tIFwiLi90aW1lXCI7XG5cbmV4cG9ydCB0eXBlIFdvcmtpbmdIb3VycyA9IFJlY29yZDxzdHJpbmcsIHsgc3RhcnQ6IHN0cmluZzsgZW5kOiBzdHJpbmcgfVtdPjtcblxuZXhwb3J0IHR5cGUgQnVzeUFwcG9pbnRtZW50ID0ge1xuICBzdGFydF90aW1lX3V0Yzogc3RyaW5nO1xuICBlbmRfdGltZV91dGM6IHN0cmluZztcbn07XG5cbmV4cG9ydCBjb25zdCBnZW5lcmF0ZVNsb3RzID0gKHtcbiAgZGF0ZSxcbiAgdGltZVpvbmUsXG4gIHdvcmtpbmdIb3VycyxcbiAgc2VydmljZUR1cmF0aW9uTWludXRlcyxcbiAgYnVmZmVyTWludXRlcyxcbiAgYXBwb2ludG1lbnRzLFxufToge1xuICBkYXRlOiBzdHJpbmc7XG4gIHRpbWVab25lOiBzdHJpbmc7XG4gIHdvcmtpbmdIb3VyczogV29ya2luZ0hvdXJzO1xuICBzZXJ2aWNlRHVyYXRpb25NaW51dGVzOiBudW1iZXI7XG4gIGJ1ZmZlck1pbnV0ZXM6IG51bWJlcjtcbiAgYXBwb2ludG1lbnRzOiBCdXN5QXBwb2ludG1lbnRbXTtcbn0pID0+IHtcbiAgY29uc3QgZGF5S2V5ID0gRGF0ZVRpbWUuZnJvbUlTTyhkYXRlLCB7IHpvbmU6IHRpbWVab25lIH0pLnRvRm9ybWF0KFwiY2NjY1wiKTtcbiAgY29uc3QgcmFuZ2VzID0gd29ya2luZ0hvdXJzW2RheUtleV0gPz8gW107XG4gIGNvbnN0IHNsb3RzOiB7IHN0YXJ0VGltZUxvY2FsSVNPOiBzdHJpbmc7IGxhYmVsOiBzdHJpbmcgfVtdID0gW107XG4gIGNvbnN0IG5vd0xvY2FsID0gRGF0ZVRpbWUubm93KCkuc2V0Wm9uZSh0aW1lWm9uZSk7XG5cbiAgY29uc3QgYnVzeVdpbmRvd3MgPSBhcHBvaW50bWVudHMubWFwKChhcHB0KSA9PiB7XG4gICAgY29uc3Qgc3RhcnQgPSBEYXRlVGltZS5mcm9tSVNPKGFwcHQuc3RhcnRfdGltZV91dGMsIHsgem9uZTogXCJ1dGNcIiB9KTtcbiAgICBjb25zdCBlbmQgPSBEYXRlVGltZS5mcm9tSVNPKGFwcHQuZW5kX3RpbWVfdXRjLCB7IHpvbmU6IFwidXRjXCIgfSkucGx1cyh7XG4gICAgICBtaW51dGVzOiBidWZmZXJNaW51dGVzLFxuICAgIH0pO1xuICAgIHJldHVybiB7IHN0YXJ0LCBlbmQgfTtcbiAgfSk7XG5cbiAgcmFuZ2VzLmZvckVhY2goKHJhbmdlKSA9PiB7XG4gICAgY29uc3QgcmFuZ2VTdGFydCA9IGJ1aWxkTG9jYWxEYXRlVGltZShkYXRlLCByYW5nZS5zdGFydCwgdGltZVpvbmUpO1xuICAgIGNvbnN0IHJhbmdlRW5kID0gYnVpbGRMb2NhbERhdGVUaW1lKGRhdGUsIHJhbmdlLmVuZCwgdGltZVpvbmUpO1xuICAgIGxldCBjdXJzb3IgPSByYW5nZVN0YXJ0O1xuXG4gICAgd2hpbGUgKGN1cnNvci5wbHVzKHsgbWludXRlczogc2VydmljZUR1cmF0aW9uTWludXRlcyB9KSA8PSByYW5nZUVuZCkge1xuICAgICAgY29uc3QgbG9jYWxTdGFydCA9IGN1cnNvcjtcbiAgICAgIGNvbnN0IGxvY2FsRW5kID0gY3Vyc29yLnBsdXMoeyBtaW51dGVzOiBzZXJ2aWNlRHVyYXRpb25NaW51dGVzIH0pO1xuICAgICAgY29uc3QgbG9jYWxFbmRXaXRoQnVmZmVyID0gbG9jYWxFbmQucGx1cyh7IG1pbnV0ZXM6IGJ1ZmZlck1pbnV0ZXMgfSk7XG4gICAgICBjb25zdCB1dGNTdGFydCA9IGxvY2FsU3RhcnQudG9VVEMoKTtcbiAgICAgIGNvbnN0IHV0Y0VuZCA9IGxvY2FsRW5kV2l0aEJ1ZmZlci50b1VUQygpO1xuICAgICAgY29uc3Qgb3ZlcmxhcHMgPSBidXN5V2luZG93cy5zb21lKFxuICAgICAgICAod2luZG93KSA9PiB1dGNTdGFydCA8IHdpbmRvdy5lbmQgJiYgdXRjRW5kID4gd2luZG93LnN0YXJ0XG4gICAgICApO1xuICAgICAgY29uc3QgaXNGdXR1cmUgPSBsb2NhbFN0YXJ0ID49IG5vd0xvY2FsO1xuICAgICAgaWYgKCFvdmVybGFwcyAmJiBpc0Z1dHVyZSkge1xuICAgICAgICBzbG90cy5wdXNoKHtcbiAgICAgICAgICBzdGFydFRpbWVMb2NhbElTTzogbG9jYWxTdGFydC50b0lTTygpID8/IFwiXCIsXG4gICAgICAgICAgbGFiZWw6IGxvY2FsU3RhcnQudG9Gb3JtYXQoXCJoOm1tIGFcIiksXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgY3Vyc29yID0gY3Vyc29yLnBsdXMoeyBtaW51dGVzOiAxNSB9KTtcbiAgICB9XG4gIH0pO1xuXG4gIHJldHVybiBzbG90cztcbn07XHJcbiJdLCJuYW1lcyI6WyJEYXRlVGltZSIsImJ1aWxkTG9jYWxEYXRlVGltZSIsImdlbmVyYXRlU2xvdHMiLCJkYXRlIiwidGltZVpvbmUiLCJ3b3JraW5nSG91cnMiLCJzZXJ2aWNlRHVyYXRpb25NaW51dGVzIiwiYnVmZmVyTWludXRlcyIsImFwcG9pbnRtZW50cyIsImRheUtleSIsImZyb21JU08iLCJ6b25lIiwidG9Gb3JtYXQiLCJyYW5nZXMiLCJzbG90cyIsIm5vd0xvY2FsIiwibm93Iiwic2V0Wm9uZSIsImJ1c3lXaW5kb3dzIiwibWFwIiwiYXBwdCIsInN0YXJ0Iiwic3RhcnRfdGltZV91dGMiLCJlbmQiLCJlbmRfdGltZV91dGMiLCJwbHVzIiwibWludXRlcyIsImZvckVhY2giLCJyYW5nZSIsInJhbmdlU3RhcnQiLCJyYW5nZUVuZCIsImN1cnNvciIsImxvY2FsU3RhcnQiLCJsb2NhbEVuZCIsImxvY2FsRW5kV2l0aEJ1ZmZlciIsInV0Y1N0YXJ0IiwidG9VVEMiLCJ1dGNFbmQiLCJvdmVybGFwcyIsInNvbWUiLCJ3aW5kb3ciLCJpc0Z1dHVyZSIsInB1c2giLCJzdGFydFRpbWVMb2NhbElTTyIsInRvSVNPIiwibGFiZWwiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./lib/availability.ts\n");

/***/ }),

/***/ "(rsc)/./lib/server/appointments.ts":
/*!************************************!*\
  !*** ./lib/server/appointments.ts ***!
  \************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   fetchAppointmentBySession: () => (/* binding */ fetchAppointmentBySession),\n/* harmony export */   fetchService: () => (/* binding */ fetchService),\n/* harmony export */   fetchSettings: () => (/* binding */ fetchSettings)\n/* harmony export */ });\n/* harmony import */ var _supabase_client__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../supabase/client */ \"(rsc)/./lib/supabase/client.ts\");\n/* harmony import */ var _time__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../time */ \"(rsc)/./lib/time.ts\");\n\n\nconst fetchSettings = async ()=>{\n    const supabase = (0,_supabase_client__WEBPACK_IMPORTED_MODULE_0__.getSupabaseClient)();\n    const { data, error } = await supabase.from(\"business_settings\").select(\"*\").limit(1).maybeSingle();\n    if (error) throw error;\n    if (!data) {\n        return {\n            time_zone: _time__WEBPACK_IMPORTED_MODULE_1__.DEFAULT_TIME_ZONE,\n            late_grace_minutes: 15,\n            reschedule_min_hours: 72,\n            deposit_amount_default: 20,\n            buffer_minutes: 0,\n            working_hours_json: {},\n            address: null,\n            phone: null,\n            policy_text: null\n        };\n    }\n    return data;\n};\nconst fetchService = async (serviceId)=>{\n    const supabase = (0,_supabase_client__WEBPACK_IMPORTED_MODULE_0__.getSupabaseClient)();\n    const { data, error } = await supabase.from(\"services\").select(\"*\").eq(\"id\", serviceId).single();\n    if (error) throw error;\n    return data;\n};\nconst fetchAppointmentBySession = async (sessionId)=>{\n    const supabase = (0,_supabase_client__WEBPACK_IMPORTED_MODULE_0__.getSupabaseClient)();\n    const payment = await supabase.from(\"payments\").select(\"appointment_id\").eq(\"stripe_checkout_session_id\", sessionId).maybeSingle();\n    if (!payment.data) return null;\n    const appointment = await supabase.from(\"appointments\").select(\"id, service_id, start_time_utc\").eq(\"id\", payment.data.appointment_id).maybeSingle();\n    return appointment.data ?? null;\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvc2VydmVyL2FwcG9pbnRtZW50cy50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUF1RDtBQUNYO0FBRXJDLE1BQU1FLGdCQUFnQjtJQUMzQixNQUFNQyxXQUFXSCxtRUFBaUJBO0lBQ2xDLE1BQU0sRUFBRUksSUFBSSxFQUFFQyxLQUFLLEVBQUUsR0FBRyxNQUFNRixTQUMzQkcsSUFBSSxDQUFDLHFCQUNMQyxNQUFNLENBQUMsS0FDUEMsS0FBSyxDQUFDLEdBQ05DLFdBQVc7SUFDZCxJQUFJSixPQUFPLE1BQU1BO0lBQ2pCLElBQUksQ0FBQ0QsTUFBTTtRQUNULE9BQU87WUFDTE0sV0FBV1Qsb0RBQWlCQTtZQUM1QlUsb0JBQW9CO1lBQ3BCQyxzQkFBc0I7WUFDdEJDLHdCQUF3QjtZQUN4QkMsZ0JBQWdCO1lBQ2hCQyxvQkFBb0IsQ0FBQztZQUNyQkMsU0FBUztZQUNUQyxPQUFPO1lBQ1BDLGFBQWE7UUFDZjtJQUNGO0lBQ0EsT0FBT2Q7QUFDVCxFQUFFO0FBRUssTUFBTWUsZUFBZSxPQUFPQztJQUNqQyxNQUFNakIsV0FBV0gsbUVBQWlCQTtJQUNsQyxNQUFNLEVBQUVJLElBQUksRUFBRUMsS0FBSyxFQUFFLEdBQUcsTUFBTUYsU0FDM0JHLElBQUksQ0FBQyxZQUNMQyxNQUFNLENBQUMsS0FDUGMsRUFBRSxDQUFDLE1BQU1ELFdBQ1RFLE1BQU07SUFDVCxJQUFJakIsT0FBTyxNQUFNQTtJQUNqQixPQUFPRDtBQUNULEVBQUU7QUFFSyxNQUFNbUIsNEJBQTRCLE9BQU9DO0lBQzlDLE1BQU1yQixXQUFXSCxtRUFBaUJBO0lBQ2xDLE1BQU15QixVQUFVLE1BQU10QixTQUNuQkcsSUFBSSxDQUFDLFlBQ0xDLE1BQU0sQ0FBQyxrQkFDUGMsRUFBRSxDQUFDLDhCQUE4QkcsV0FDakNmLFdBQVc7SUFDZCxJQUFJLENBQUNnQixRQUFRckIsSUFBSSxFQUFFLE9BQU87SUFDMUIsTUFBTXNCLGNBQWMsTUFBTXZCLFNBQ3ZCRyxJQUFJLENBQUMsZ0JBQ0xDLE1BQU0sQ0FBQyxrQ0FDUGMsRUFBRSxDQUFDLE1BQU1JLFFBQVFyQixJQUFJLENBQUN1QixjQUFjLEVBQ3BDbEIsV0FBVztJQUNkLE9BQU9pQixZQUFZdEIsSUFBSSxJQUFJO0FBQzdCLEVBQUUiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9jdXR6LWJ5LWNhc3Blci8uL2xpYi9zZXJ2ZXIvYXBwb2ludG1lbnRzLnRzP2ZiZWUiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgZ2V0U3VwYWJhc2VDbGllbnQgfSBmcm9tIFwiLi4vc3VwYWJhc2UvY2xpZW50XCI7XG5pbXBvcnQgeyBERUZBVUxUX1RJTUVfWk9ORSB9IGZyb20gXCIuLi90aW1lXCI7XG5cbmV4cG9ydCBjb25zdCBmZXRjaFNldHRpbmdzID0gYXN5bmMgKCkgPT4ge1xuICBjb25zdCBzdXBhYmFzZSA9IGdldFN1cGFiYXNlQ2xpZW50KCk7XG4gIGNvbnN0IHsgZGF0YSwgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgLmZyb20oXCJidXNpbmVzc19zZXR0aW5nc1wiKVxuICAgIC5zZWxlY3QoXCIqXCIpXG4gICAgLmxpbWl0KDEpXG4gICAgLm1heWJlU2luZ2xlKCk7XG4gIGlmIChlcnJvcikgdGhyb3cgZXJyb3I7XG4gIGlmICghZGF0YSkge1xuICAgIHJldHVybiB7XG4gICAgICB0aW1lX3pvbmU6IERFRkFVTFRfVElNRV9aT05FLFxuICAgICAgbGF0ZV9ncmFjZV9taW51dGVzOiAxNSxcbiAgICAgIHJlc2NoZWR1bGVfbWluX2hvdXJzOiA3MixcbiAgICAgIGRlcG9zaXRfYW1vdW50X2RlZmF1bHQ6IDIwLFxuICAgICAgYnVmZmVyX21pbnV0ZXM6IDAsXG4gICAgICB3b3JraW5nX2hvdXJzX2pzb246IHt9LFxuICAgICAgYWRkcmVzczogbnVsbCxcbiAgICAgIHBob25lOiBudWxsLFxuICAgICAgcG9saWN5X3RleHQ6IG51bGwsXG4gICAgfTtcbiAgfVxuICByZXR1cm4gZGF0YTtcbn07XG5cbmV4cG9ydCBjb25zdCBmZXRjaFNlcnZpY2UgPSBhc3luYyAoc2VydmljZUlkOiBzdHJpbmcpID0+IHtcbiAgY29uc3Qgc3VwYWJhc2UgPSBnZXRTdXBhYmFzZUNsaWVudCgpO1xuICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgIC5mcm9tKFwic2VydmljZXNcIilcbiAgICAuc2VsZWN0KFwiKlwiKVxuICAgIC5lcShcImlkXCIsIHNlcnZpY2VJZClcbiAgICAuc2luZ2xlKCk7XG4gIGlmIChlcnJvcikgdGhyb3cgZXJyb3I7XG4gIHJldHVybiBkYXRhO1xufTtcblxuZXhwb3J0IGNvbnN0IGZldGNoQXBwb2ludG1lbnRCeVNlc3Npb24gPSBhc3luYyAoc2Vzc2lvbklkOiBzdHJpbmcpID0+IHtcbiAgY29uc3Qgc3VwYWJhc2UgPSBnZXRTdXBhYmFzZUNsaWVudCgpO1xuICBjb25zdCBwYXltZW50ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAuZnJvbShcInBheW1lbnRzXCIpXG4gICAgLnNlbGVjdChcImFwcG9pbnRtZW50X2lkXCIpXG4gICAgLmVxKFwic3RyaXBlX2NoZWNrb3V0X3Nlc3Npb25faWRcIiwgc2Vzc2lvbklkKVxuICAgIC5tYXliZVNpbmdsZSgpO1xuICBpZiAoIXBheW1lbnQuZGF0YSkgcmV0dXJuIG51bGw7XG4gIGNvbnN0IGFwcG9pbnRtZW50ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAuZnJvbShcImFwcG9pbnRtZW50c1wiKVxuICAgIC5zZWxlY3QoXCJpZCwgc2VydmljZV9pZCwgc3RhcnRfdGltZV91dGNcIilcbiAgICAuZXEoXCJpZFwiLCBwYXltZW50LmRhdGEuYXBwb2ludG1lbnRfaWQpXG4gICAgLm1heWJlU2luZ2xlKCk7XG4gIHJldHVybiBhcHBvaW50bWVudC5kYXRhID8/IG51bGw7XG59O1xyXG4iXSwibmFtZXMiOlsiZ2V0U3VwYWJhc2VDbGllbnQiLCJERUZBVUxUX1RJTUVfWk9ORSIsImZldGNoU2V0dGluZ3MiLCJzdXBhYmFzZSIsImRhdGEiLCJlcnJvciIsImZyb20iLCJzZWxlY3QiLCJsaW1pdCIsIm1heWJlU2luZ2xlIiwidGltZV96b25lIiwibGF0ZV9ncmFjZV9taW51dGVzIiwicmVzY2hlZHVsZV9taW5faG91cnMiLCJkZXBvc2l0X2Ftb3VudF9kZWZhdWx0IiwiYnVmZmVyX21pbnV0ZXMiLCJ3b3JraW5nX2hvdXJzX2pzb24iLCJhZGRyZXNzIiwicGhvbmUiLCJwb2xpY3lfdGV4dCIsImZldGNoU2VydmljZSIsInNlcnZpY2VJZCIsImVxIiwic2luZ2xlIiwiZmV0Y2hBcHBvaW50bWVudEJ5U2Vzc2lvbiIsInNlc3Npb25JZCIsInBheW1lbnQiLCJhcHBvaW50bWVudCIsImFwcG9pbnRtZW50X2lkIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./lib/server/appointments.ts\n");

/***/ }),

/***/ "(rsc)/./lib/server/assistant.ts":
/*!*********************************!*\
  !*** ./lib/server/assistant.ts ***!
  \*********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   generateAssistantReply: () => (/* binding */ generateAssistantReply)\n/* harmony export */ });\n/* harmony import */ var luxon__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! luxon */ \"(rsc)/./node_modules/luxon/build/es6/luxon.mjs\");\n/* harmony import */ var _lib_supabase_client__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/lib/supabase/client */ \"(rsc)/./lib/supabase/client.ts\");\n/* harmony import */ var _lib_availability__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/availability */ \"(rsc)/./lib/availability.ts\");\n/* harmony import */ var _lib_server_appointments__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/lib/server/appointments */ \"(rsc)/./lib/server/appointments.ts\");\n/* harmony import */ var _lib_server_checkout__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/lib/server/checkout */ \"(rsc)/./lib/server/checkout.ts\");\n\n\n\n\n\nconst BUSINESS_FALLBACK = {\n    name: \"Casper (Cutz By Casper)\",\n    address: \"442 Ridge Rd, Lyndhurst, NJ 07071\",\n    phone: \"(201) 889-6440\",\n    phoneE164: \"+12018896440\",\n    policyText: \"STRICT POLICY ON 24hr CANCELLATIONS\",\n    hours: [\n        {\n            day: \"Sunday\",\n            hours: \"09:00–13:00\"\n        },\n        {\n            day: \"Monday\",\n            hours: \"Closed\"\n        },\n        {\n            day: \"Tuesday\",\n            hours: \"Closed\"\n        },\n        {\n            day: \"Wednesday\",\n            hours: \"11:00–18:00\"\n        },\n        {\n            day: \"Thursday\",\n            hours: \"10:00–19:00\"\n        },\n        {\n            day: \"Friday\",\n            hours: \"12:00–19:00\"\n        },\n        {\n            day: \"Saturday\",\n            hours: \"10:00–17:00\"\n        }\n    ]\n};\nconst tools = [\n    {\n        type: \"function\",\n        function: {\n            name: \"list_services\",\n            description: \"List services with durations, pricing, and whether they can be booked online.\",\n            parameters: {\n                type: \"object\",\n                properties: {}\n            }\n        }\n    },\n    {\n        type: \"function\",\n        function: {\n            name: \"get_available_slots\",\n            description: \"Get available appointment slots for a service on a date.\",\n            parameters: {\n                type: \"object\",\n                properties: {\n                    serviceId: {\n                        type: \"string\"\n                    },\n                    dateISO: {\n                        type: \"string\",\n                        description: \"YYYY-MM-DD in local time\"\n                    }\n                },\n                required: [\n                    \"serviceId\",\n                    \"dateISO\"\n                ]\n            }\n        }\n    },\n    {\n        type: \"function\",\n        function: {\n            name: \"create_checkout\",\n            description: \"Create a Stripe Checkout session after the user confirms service, time, and policies.\",\n            parameters: {\n                type: \"object\",\n                properties: {\n                    serviceId: {\n                        type: \"string\"\n                    },\n                    startTimeLocalISO: {\n                        type: \"string\"\n                    },\n                    fullName: {\n                        type: \"string\"\n                    },\n                    phoneE164: {\n                        type: \"string\"\n                    },\n                    smsOptIn: {\n                        type: \"boolean\"\n                    }\n                },\n                required: [\n                    \"serviceId\",\n                    \"startTimeLocalISO\",\n                    \"fullName\",\n                    \"phoneE164\",\n                    \"smsOptIn\"\n                ]\n            }\n        }\n    },\n    {\n        type: \"function\",\n        function: {\n            name: \"get_business_info\",\n            description: \"Get address, phone, weekly hours, and policy copy.\",\n            parameters: {\n                type: \"object\",\n                properties: {}\n            }\n        }\n    }\n];\nconst systemPrompt = `\nYou are the AI secretary for “Cutz By Casper.” You are warm, efficient, and professional.\nUse short sentences. Confirm details. Offer clear choices. Speak like a receptionist.\nExample tone: “Of course. What day works best for you? I can do Wednesday at 2:00, 3:15,\nor 4:30. Which would you like?”\n\nHard rules:\n- Never guess availability or pricing. Always call tools.\n- Always confirm service + date/time + deposit policy before creating checkout.\n- Never finalize a booking without explicit confirmation like “Yes, book it.”\n- Deposit $20 charged immediately to book.\n- Reschedule only 72+ hours before.\n- 15+ minutes late = no-show, deposit forfeited.\n- For “Before & After Hours Appointments (Text me direct) — $100+”, do NOT book online.\n  Provide call/text instructions instead.\nCollect: service, preferred day/time, full name, phone (E.164), SMS opt-in.\nOffer up to 3 available slots.\nAlways restate appointment details and policies right before checkout.\n`.trim();\nconst safeParseArgs = (raw)=>{\n    if (!raw) return {};\n    try {\n        return JSON.parse(raw);\n    } catch  {\n        return {};\n    }\n};\nconst callOpenAI = async (messages)=>{\n    const apiKey = process.env.OPENAI_API_KEY;\n    if (!apiKey) {\n        throw new Error(\"OPENAI_API_KEY is not set\");\n    }\n    const response = await fetch(\"https://api.openai.com/v1/chat/completions\", {\n        method: \"POST\",\n        headers: {\n            \"Content-Type\": \"application/json\",\n            Authorization: `Bearer ${apiKey}`\n        },\n        body: JSON.stringify({\n            model: \"gpt-4o-mini\",\n            temperature: 0.2,\n            messages: [\n                {\n                    role: \"system\",\n                    content: systemPrompt\n                },\n                ...messages\n            ],\n            tools\n        })\n    });\n    if (!response.ok) {\n        const text = await response.text();\n        throw new Error(`OpenAI error: ${text}`);\n    }\n    return response.json();\n};\nconst handleTool = async (name, args)=>{\n    const supabase = (0,_lib_supabase_client__WEBPACK_IMPORTED_MODULE_0__.getSupabaseClient)();\n    const settings = await (0,_lib_server_appointments__WEBPACK_IMPORTED_MODULE_2__.fetchSettings)();\n    switch(name){\n        case \"list_services\":\n            {\n                const { data, error } = await supabase.from(\"services\").select(\"id, name, duration_minutes, price_display, note, price_from\").eq(\"active\", true).order(\"created_at\", {\n                    ascending: true\n                });\n                if (error) {\n                    return {\n                        error: error.message\n                    };\n                }\n                return {\n                    services: (data ?? []).map((service)=>({\n                            ...service,\n                            bookable_online: !service.price_from\n                        }))\n                };\n            }\n        case \"get_available_slots\":\n            {\n                const { serviceId, dateISO } = args ?? {};\n                if (!serviceId || !dateISO) {\n                    return {\n                        error: \"Missing serviceId or dateISO\"\n                    };\n                }\n                const service = await supabase.from(\"services\").select(\"duration_minutes, price_from\").eq(\"id\", serviceId).single();\n                if (service.error) {\n                    return {\n                        error: service.error.message\n                    };\n                }\n                if (service.data.price_from) {\n                    return {\n                        slots: []\n                    };\n                }\n                const localStart = luxon__WEBPACK_IMPORTED_MODULE_4__.DateTime.fromISO(dateISO, {\n                    zone: settings.time_zone\n                }).startOf(\"day\");\n                const localEnd = localStart.endOf(\"day\");\n                const dayStartUtc = localStart.toUTC().toISO();\n                const dayEndUtc = localEnd.toUTC().toISO();\n                const { data: appointments } = await supabase.from(\"appointments\").select(\"start_time_utc, end_time_utc, status, hold_expires_at_utc\").lt(\"start_time_utc\", dayEndUtc).gt(\"end_time_utc\", dayStartUtc).in(\"status\", [\n                    \"booked\",\n                    \"pending_payment\"\n                ]);\n                const { data: blocks } = await supabase.from(\"time_blocks\").select(\"start_time_utc, end_time_utc\").lt(\"start_time_utc\", dayEndUtc).gt(\"end_time_utc\", dayStartUtc);\n                const nowUtc = luxon__WEBPACK_IMPORTED_MODULE_4__.DateTime.utc().toISO();\n                const filtered = (appointments ?? []).filter((appt)=>{\n                    if (appt.status !== \"pending_payment\") return true;\n                    return appt.hold_expires_at_utc && appt.hold_expires_at_utc > nowUtc;\n                });\n                const slots = (0,_lib_availability__WEBPACK_IMPORTED_MODULE_1__.generateSlots)({\n                    date: dateISO,\n                    timeZone: settings.time_zone,\n                    workingHours: settings.working_hours_json,\n                    serviceDurationMinutes: service.data.duration_minutes,\n                    bufferMinutes: settings.buffer_minutes,\n                    appointments: [\n                        ...filtered,\n                        ...blocks ?? []\n                    ]\n                });\n                return {\n                    slots\n                };\n            }\n        case \"create_checkout\":\n            {\n                try {\n                    const result = await (0,_lib_server_checkout__WEBPACK_IMPORTED_MODULE_3__.createCheckoutSession)(args);\n                    return result;\n                } catch (error) {\n                    return {\n                        error: error instanceof Error ? error.message : \"Checkout failed.\"\n                    };\n                }\n            }\n        case \"get_business_info\":\n            {\n                return {\n                    name: BUSINESS_FALLBACK.name,\n                    address: settings.address ?? BUSINESS_FALLBACK.address,\n                    phone: settings.phone ?? BUSINESS_FALLBACK.phone,\n                    phoneE164: BUSINESS_FALLBACK.phoneE164,\n                    policyText: settings.policy_text ?? BUSINESS_FALLBACK.policyText,\n                    timeZone: settings.time_zone ?? \"America/New_York\",\n                    hours: settings.working_hours_json ?? BUSINESS_FALLBACK.hours,\n                    rules: {\n                        deposit: \"$20 charged immediately to book\",\n                        reschedule: \"Allowed only 72+ hours before\",\n                        late: \"15+ minutes late = no-show; deposit forfeited\"\n                    }\n                };\n            }\n        default:\n            return {\n                error: \"Unknown tool\"\n            };\n    }\n};\nconst generateAssistantReply = async (messages)=>{\n    let actions = [];\n    let replyText = \"\";\n    let conversation = [\n        ...messages\n    ];\n    for(let i = 0; i < 3; i += 1){\n        const response = await callOpenAI(conversation);\n        const message = response.choices?.[0]?.message;\n        if (!message) {\n            throw new Error(\"No assistant response\");\n        }\n        const toolCalls = message.tool_calls ?? [];\n        if (toolCalls.length === 0) {\n            replyText = message.content ?? \"\";\n            break;\n        }\n        conversation = [\n            ...conversation,\n            {\n                role: \"assistant\",\n                content: message.content ?? \"\",\n                tool_calls: toolCalls\n            }\n        ];\n        for (const call of toolCalls){\n            const args = safeParseArgs(call.function?.arguments);\n            const toolResult = await handleTool(call.function.name, args);\n            if (call.function.name === \"create_checkout\" && toolResult.checkoutUrl) {\n                actions.push({\n                    type: \"checkout\",\n                    label: \"Open Stripe Checkout\",\n                    url: toolResult.checkoutUrl\n                });\n            }\n            conversation.push({\n                role: \"tool\",\n                tool_call_id: call.id,\n                content: JSON.stringify(toolResult)\n            });\n        }\n    }\n    if (!replyText) {\n        replyText = \"I can help with services and availability. What would you like to book?\";\n    }\n    if (!actions.length) {\n        const phone = BUSINESS_FALLBACK.phoneE164;\n        const lower = replyText.toLowerCase();\n        if (lower.includes(\"text\") || lower.includes(\"call\")) {\n            actions = [\n                {\n                    type: \"text\",\n                    label: \"Text Casper\",\n                    url: `sms:${phone}`\n                },\n                {\n                    type: \"call\",\n                    label: \"Call Casper\",\n                    url: `tel:${phone}`\n                }\n            ];\n        }\n    }\n    return {\n        replyText,\n        actions\n    };\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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U0FBUztZQUNwRG5CLFVBQVU7Z0JBQ1I7b0JBQUUvRixNQUFNO29CQUFRNEcsT0FBTztvQkFBZUMsS0FBSyxDQUFDLElBQUksRUFBRW5ILE1BQU0sQ0FBQztnQkFBQztnQkFDMUQ7b0JBQUVNLE1BQU07b0JBQVE0RyxPQUFPO29CQUFlQyxLQUFLLENBQUMsSUFBSSxFQUFFbkgsTUFBTSxDQUFDO2dCQUFDO2FBQzNEO1FBQ0g7SUFDRjtJQUVBLE9BQU87UUFBRXNHO1FBQVdEO0lBQVE7QUFDOUIsRUFBRSIsInNvdXJjZXMiOlsid2VicGFjazovL2N1dHotYnktY2FzcGVyLy4vbGliL3NlcnZlci9hc3Npc3RhbnQudHM/ZDhkZCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBEYXRlVGltZSB9IGZyb20gXCJsdXhvblwiO1xuaW1wb3J0IHsgZ2V0U3VwYWJhc2VDbGllbnQgfSBmcm9tIFwiQC9saWIvc3VwYWJhc2UvY2xpZW50XCI7XG5pbXBvcnQgeyBnZW5lcmF0ZVNsb3RzIH0gZnJvbSBcIkAvbGliL2F2YWlsYWJpbGl0eVwiO1xuaW1wb3J0IHsgZmV0Y2hTZXR0aW5ncyB9IGZyb20gXCJAL2xpYi9zZXJ2ZXIvYXBwb2ludG1lbnRzXCI7XG5pbXBvcnQgeyBjcmVhdGVDaGVja291dFNlc3Npb24gfSBmcm9tIFwiQC9saWIvc2VydmVyL2NoZWNrb3V0XCI7XG5cbmV4cG9ydCB0eXBlIEFzc2lzdGFudEFjdGlvbiA9IHtcbiAgdHlwZTogXCJjaGVja291dFwiIHwgXCJjYWxsXCIgfCBcInRleHRcIiB8IFwib3Blbl9ib29raW5nXCI7XG4gIGxhYmVsOiBzdHJpbmc7XG4gIHVybD86IHN0cmluZztcbn07XG5cbnR5cGUgQXNzaXN0YW50TWVzc2FnZSA9IHtcbiAgcm9sZTogXCJ1c2VyXCIgfCBcImFzc2lzdGFudFwiO1xuICBjb250ZW50OiBzdHJpbmc7XG59O1xuXG5jb25zdCBCVVNJTkVTU19GQUxMQkFDSyA9IHtcbiAgbmFtZTogXCJDYXNwZXIgKEN1dHogQnkgQ2FzcGVyKVwiLFxuICBhZGRyZXNzOiBcIjQ0MiBSaWRnZSBSZCwgTHluZGh1cnN0LCBOSiAwNzA3MVwiLFxuICBwaG9uZTogXCIoMjAxKSA4ODktNjQ0MFwiLFxuICBwaG9uZUUxNjQ6IFwiKzEyMDE4ODk2NDQwXCIsXG4gIHBvbGljeVRleHQ6IFwiU1RSSUNUIFBPTElDWSBPTiAyNGhyIENBTkNFTExBVElPTlNcIixcbiAgaG91cnM6IFtcbiAgICB7IGRheTogXCJTdW5kYXlcIiwgaG91cnM6IFwiMDk6MDDigJMxMzowMFwiIH0sXG4gICAgeyBkYXk6IFwiTW9uZGF5XCIsIGhvdXJzOiBcIkNsb3NlZFwiIH0sXG4gICAgeyBkYXk6IFwiVHVlc2RheVwiLCBob3VyczogXCJDbG9zZWRcIiB9LFxuICAgIHsgZGF5OiBcIldlZG5lc2RheVwiLCBob3VyczogXCIxMTowMOKAkzE4OjAwXCIgfSxcbiAgICB7IGRheTogXCJUaHVyc2RheVwiLCBob3VyczogXCIxMDowMOKAkzE5OjAwXCIgfSxcbiAgICB7IGRheTogXCJGcmlkYXlcIiwgaG91cnM6IFwiMTI6MDDigJMxOTowMFwiIH0sXG4gICAgeyBkYXk6IFwiU2F0dXJkYXlcIiwgaG91cnM6IFwiMTA6MDDigJMxNzowMFwiIH0sXG4gIF0sXG59O1xuXG5jb25zdCB0b29scyA9IFtcbiAge1xuICAgIHR5cGU6IFwiZnVuY3Rpb25cIixcbiAgICBmdW5jdGlvbjoge1xuICAgICAgbmFtZTogXCJsaXN0X3NlcnZpY2VzXCIsXG4gICAgICBkZXNjcmlwdGlvbjpcbiAgICAgICAgXCJMaXN0IHNlcnZpY2VzIHdpdGggZHVyYXRpb25zLCBwcmljaW5nLCBhbmQgd2hldGhlciB0aGV5IGNhbiBiZSBib29rZWQgb25saW5lLlwiLFxuICAgICAgcGFyYW1ldGVyczogeyB0eXBlOiBcIm9iamVjdFwiLCBwcm9wZXJ0aWVzOiB7fSB9LFxuICAgIH0sXG4gIH0sXG4gIHtcbiAgICB0eXBlOiBcImZ1bmN0aW9uXCIsXG4gICAgZnVuY3Rpb246IHtcbiAgICAgIG5hbWU6IFwiZ2V0X2F2YWlsYWJsZV9zbG90c1wiLFxuICAgICAgZGVzY3JpcHRpb246IFwiR2V0IGF2YWlsYWJsZSBhcHBvaW50bWVudCBzbG90cyBmb3IgYSBzZXJ2aWNlIG9uIGEgZGF0ZS5cIixcbiAgICAgIHBhcmFtZXRlcnM6IHtcbiAgICAgICAgdHlwZTogXCJvYmplY3RcIixcbiAgICAgICAgcHJvcGVydGllczoge1xuICAgICAgICAgIHNlcnZpY2VJZDogeyB0eXBlOiBcInN0cmluZ1wiIH0sXG4gICAgICAgICAgZGF0ZUlTTzogeyB0eXBlOiBcInN0cmluZ1wiLCBkZXNjcmlwdGlvbjogXCJZWVlZLU1NLUREIGluIGxvY2FsIHRpbWVcIiB9LFxuICAgICAgICB9LFxuICAgICAgICByZXF1aXJlZDogW1wic2VydmljZUlkXCIsIFwiZGF0ZUlTT1wiXSxcbiAgICAgIH0sXG4gICAgfSxcbiAgfSxcbiAge1xuICAgIHR5cGU6IFwiZnVuY3Rpb25cIixcbiAgICBmdW5jdGlvbjoge1xuICAgICAgbmFtZTogXCJjcmVhdGVfY2hlY2tvdXRcIixcbiAgICAgIGRlc2NyaXB0aW9uOlxuICAgICAgICBcIkNyZWF0ZSBhIFN0cmlwZSBDaGVja291dCBzZXNzaW9uIGFmdGVyIHRoZSB1c2VyIGNvbmZpcm1zIHNlcnZpY2UsIHRpbWUsIGFuZCBwb2xpY2llcy5cIixcbiAgICAgIHBhcmFtZXRlcnM6IHtcbiAgICAgICAgdHlwZTogXCJvYmplY3RcIixcbiAgICAgICAgcHJvcGVydGllczoge1xuICAgICAgICAgIHNlcnZpY2VJZDogeyB0eXBlOiBcInN0cmluZ1wiIH0sXG4gICAgICAgICAgc3RhcnRUaW1lTG9jYWxJU086IHsgdHlwZTogXCJzdHJpbmdcIiB9LFxuICAgICAgICAgIGZ1bGxOYW1lOiB7IHR5cGU6IFwic3RyaW5nXCIgfSxcbiAgICAgICAgICBwaG9uZUUxNjQ6IHsgdHlwZTogXCJzdHJpbmdcIiB9LFxuICAgICAgICAgIHNtc09wdEluOiB7IHR5cGU6IFwiYm9vbGVhblwiIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHJlcXVpcmVkOiBbXCJzZXJ2aWNlSWRcIiwgXCJzdGFydFRpbWVMb2NhbElTT1wiLCBcImZ1bGxOYW1lXCIsIFwicGhvbmVFMTY0XCIsIFwic21zT3B0SW5cIl0sXG4gICAgICB9LFxuICAgIH0sXG4gIH0sXG4gIHtcbiAgICB0eXBlOiBcImZ1bmN0aW9uXCIsXG4gICAgZnVuY3Rpb246IHtcbiAgICAgIG5hbWU6IFwiZ2V0X2J1c2luZXNzX2luZm9cIixcbiAgICAgIGRlc2NyaXB0aW9uOiBcIkdldCBhZGRyZXNzLCBwaG9uZSwgd2Vla2x5IGhvdXJzLCBhbmQgcG9saWN5IGNvcHkuXCIsXG4gICAgICBwYXJhbWV0ZXJzOiB7IHR5cGU6IFwib2JqZWN0XCIsIHByb3BlcnRpZXM6IHt9IH0sXG4gICAgfSxcbiAgfSxcbl07XG5cbmNvbnN0IHN5c3RlbVByb21wdCA9IGBcbllvdSBhcmUgdGhlIEFJIHNlY3JldGFyeSBmb3Ig4oCcQ3V0eiBCeSBDYXNwZXIu4oCdIFlvdSBhcmUgd2FybSwgZWZmaWNpZW50LCBhbmQgcHJvZmVzc2lvbmFsLlxuVXNlIHNob3J0IHNlbnRlbmNlcy4gQ29uZmlybSBkZXRhaWxzLiBPZmZlciBjbGVhciBjaG9pY2VzLiBTcGVhayBsaWtlIGEgcmVjZXB0aW9uaXN0LlxuRXhhbXBsZSB0b25lOiDigJxPZiBjb3Vyc2UuIFdoYXQgZGF5IHdvcmtzIGJlc3QgZm9yIHlvdT8gSSBjYW4gZG8gV2VkbmVzZGF5IGF0IDI6MDAsIDM6MTUsXG5vciA0OjMwLiBXaGljaCB3b3VsZCB5b3UgbGlrZT/igJ1cblxuSGFyZCBydWxlczpcbi0gTmV2ZXIgZ3Vlc3MgYXZhaWxhYmlsaXR5IG9yIHByaWNpbmcuIEFsd2F5cyBjYWxsIHRvb2xzLlxuLSBBbHdheXMgY29uZmlybSBzZXJ2aWNlICsgZGF0ZS90aW1lICsgZGVwb3NpdCBwb2xpY3kgYmVmb3JlIGNyZWF0aW5nIGNoZWNrb3V0LlxuLSBOZXZlciBmaW5hbGl6ZSBhIGJvb2tpbmcgd2l0aG91dCBleHBsaWNpdCBjb25maXJtYXRpb24gbGlrZSDigJxZZXMsIGJvb2sgaXQu4oCdXG4tIERlcG9zaXQgJDIwIGNoYXJnZWQgaW1tZWRpYXRlbHkgdG8gYm9vay5cbi0gUmVzY2hlZHVsZSBvbmx5IDcyKyBob3VycyBiZWZvcmUuXG4tIDE1KyBtaW51dGVzIGxhdGUgPSBuby1zaG93LCBkZXBvc2l0IGZvcmZlaXRlZC5cbi0gRm9yIOKAnEJlZm9yZSAmIEFmdGVyIEhvdXJzIEFwcG9pbnRtZW50cyAoVGV4dCBtZSBkaXJlY3QpIOKAlCAkMTAwK+KAnSwgZG8gTk9UIGJvb2sgb25saW5lLlxuICBQcm92aWRlIGNhbGwvdGV4dCBpbnN0cnVjdGlvbnMgaW5zdGVhZC5cbkNvbGxlY3Q6IHNlcnZpY2UsIHByZWZlcnJlZCBkYXkvdGltZSwgZnVsbCBuYW1lLCBwaG9uZSAoRS4xNjQpLCBTTVMgb3B0LWluLlxuT2ZmZXIgdXAgdG8gMyBhdmFpbGFibGUgc2xvdHMuXG5BbHdheXMgcmVzdGF0ZSBhcHBvaW50bWVudCBkZXRhaWxzIGFuZCBwb2xpY2llcyByaWdodCBiZWZvcmUgY2hlY2tvdXQuXG5gLnRyaW0oKTtcblxuY29uc3Qgc2FmZVBhcnNlQXJncyA9IChyYXc6IHN0cmluZyB8IHVuZGVmaW5lZCkgPT4ge1xuICBpZiAoIXJhdykgcmV0dXJuIHt9O1xuICB0cnkge1xuICAgIHJldHVybiBKU09OLnBhcnNlKHJhdyk7XG4gIH0gY2F0Y2gge1xuICAgIHJldHVybiB7fTtcbiAgfVxufTtcblxuY29uc3QgY2FsbE9wZW5BSSA9IGFzeW5jIChtZXNzYWdlczogYW55W10pID0+IHtcbiAgY29uc3QgYXBpS2V5ID0gcHJvY2Vzcy5lbnYuT1BFTkFJX0FQSV9LRVk7XG4gIGlmICghYXBpS2V5KSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFwiT1BFTkFJX0FQSV9LRVkgaXMgbm90IHNldFwiKTtcbiAgfVxuXG4gIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goXCJodHRwczovL2FwaS5vcGVuYWkuY29tL3YxL2NoYXQvY29tcGxldGlvbnNcIiwge1xuICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgaGVhZGVyczoge1xuICAgICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCIsXG4gICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7YXBpS2V5fWAsXG4gICAgfSxcbiAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICBtb2RlbDogXCJncHQtNG8tbWluaVwiLFxuICAgICAgdGVtcGVyYXR1cmU6IDAuMixcbiAgICAgIG1lc3NhZ2VzOiBbXG4gICAgICAgIHsgcm9sZTogXCJzeXN0ZW1cIiwgY29udGVudDogc3lzdGVtUHJvbXB0IH0sXG4gICAgICAgIC4uLm1lc3NhZ2VzLFxuICAgICAgXSxcbiAgICAgIHRvb2xzLFxuICAgIH0pLFxuICB9KTtcblxuICBpZiAoIXJlc3BvbnNlLm9rKSB7XG4gICAgY29uc3QgdGV4dCA9IGF3YWl0IHJlc3BvbnNlLnRleHQoKTtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYE9wZW5BSSBlcnJvcjogJHt0ZXh0fWApO1xuICB9XG4gIHJldHVybiByZXNwb25zZS5qc29uKCk7XG59O1xuXG5jb25zdCBoYW5kbGVUb29sID0gYXN5bmMgKG5hbWU6IHN0cmluZywgYXJnczogYW55KSA9PiB7XG4gIGNvbnN0IHN1cGFiYXNlID0gZ2V0U3VwYWJhc2VDbGllbnQoKTtcbiAgY29uc3Qgc2V0dGluZ3MgPSBhd2FpdCBmZXRjaFNldHRpbmdzKCk7XG5cbiAgc3dpdGNoIChuYW1lKSB7XG4gICAgY2FzZSBcImxpc3Rfc2VydmljZXNcIjoge1xuICAgICAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAgICAgLmZyb20oXCJzZXJ2aWNlc1wiKVxuICAgICAgICAuc2VsZWN0KFwiaWQsIG5hbWUsIGR1cmF0aW9uX21pbnV0ZXMsIHByaWNlX2Rpc3BsYXksIG5vdGUsIHByaWNlX2Zyb21cIilcbiAgICAgICAgLmVxKFwiYWN0aXZlXCIsIHRydWUpXG4gICAgICAgIC5vcmRlcihcImNyZWF0ZWRfYXRcIiwgeyBhc2NlbmRpbmc6IHRydWUgfSk7XG4gICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgcmV0dXJuIHsgZXJyb3I6IGVycm9yLm1lc3NhZ2UgfTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB7XG4gICAgICAgIHNlcnZpY2VzOiAoZGF0YSA/PyBbXSkubWFwKChzZXJ2aWNlKSA9PiAoe1xuICAgICAgICAgIC4uLnNlcnZpY2UsXG4gICAgICAgICAgYm9va2FibGVfb25saW5lOiAhc2VydmljZS5wcmljZV9mcm9tLFxuICAgICAgICB9KSksXG4gICAgICB9O1xuICAgIH1cbiAgICBjYXNlIFwiZ2V0X2F2YWlsYWJsZV9zbG90c1wiOiB7XG4gICAgICBjb25zdCB7IHNlcnZpY2VJZCwgZGF0ZUlTTyB9ID0gYXJncyA/PyB7fTtcbiAgICAgIGlmICghc2VydmljZUlkIHx8ICFkYXRlSVNPKSB7XG4gICAgICAgIHJldHVybiB7IGVycm9yOiBcIk1pc3Npbmcgc2VydmljZUlkIG9yIGRhdGVJU09cIiB9O1xuICAgICAgfVxuXG4gICAgICBjb25zdCBzZXJ2aWNlID0gYXdhaXQgc3VwYWJhc2VcbiAgICAgICAgLmZyb20oXCJzZXJ2aWNlc1wiKVxuICAgICAgICAuc2VsZWN0KFwiZHVyYXRpb25fbWludXRlcywgcHJpY2VfZnJvbVwiKVxuICAgICAgICAuZXEoXCJpZFwiLCBzZXJ2aWNlSWQpXG4gICAgICAgIC5zaW5nbGUoKTtcbiAgICAgIGlmIChzZXJ2aWNlLmVycm9yKSB7XG4gICAgICAgIHJldHVybiB7IGVycm9yOiBzZXJ2aWNlLmVycm9yLm1lc3NhZ2UgfTtcbiAgICAgIH1cbiAgICAgIGlmIChzZXJ2aWNlLmRhdGEucHJpY2VfZnJvbSkge1xuICAgICAgICByZXR1cm4geyBzbG90czogW10gfTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgbG9jYWxTdGFydCA9IERhdGVUaW1lLmZyb21JU08oZGF0ZUlTTywge1xuICAgICAgICB6b25lOiBzZXR0aW5ncy50aW1lX3pvbmUsXG4gICAgICB9KS5zdGFydE9mKFwiZGF5XCIpO1xuICAgICAgY29uc3QgbG9jYWxFbmQgPSBsb2NhbFN0YXJ0LmVuZE9mKFwiZGF5XCIpO1xuICAgICAgY29uc3QgZGF5U3RhcnRVdGMgPSBsb2NhbFN0YXJ0LnRvVVRDKCkudG9JU08oKTtcbiAgICAgIGNvbnN0IGRheUVuZFV0YyA9IGxvY2FsRW5kLnRvVVRDKCkudG9JU08oKTtcblxuICAgICAgY29uc3QgeyBkYXRhOiBhcHBvaW50bWVudHMgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAgIC5mcm9tKFwiYXBwb2ludG1lbnRzXCIpXG4gICAgICAgIC5zZWxlY3QoXCJzdGFydF90aW1lX3V0YywgZW5kX3RpbWVfdXRjLCBzdGF0dXMsIGhvbGRfZXhwaXJlc19hdF91dGNcIilcbiAgICAgICAgLmx0KFwic3RhcnRfdGltZV91dGNcIiwgZGF5RW5kVXRjKVxuICAgICAgICAuZ3QoXCJlbmRfdGltZV91dGNcIiwgZGF5U3RhcnRVdGMpXG4gICAgICAgIC5pbihcInN0YXR1c1wiLCBbXCJib29rZWRcIiwgXCJwZW5kaW5nX3BheW1lbnRcIl0pO1xuXG4gICAgICBjb25zdCB7IGRhdGE6IGJsb2NrcyB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAgICAgLmZyb20oXCJ0aW1lX2Jsb2Nrc1wiKVxuICAgICAgICAuc2VsZWN0KFwic3RhcnRfdGltZV91dGMsIGVuZF90aW1lX3V0Y1wiKVxuICAgICAgICAubHQoXCJzdGFydF90aW1lX3V0Y1wiLCBkYXlFbmRVdGMpXG4gICAgICAgIC5ndChcImVuZF90aW1lX3V0Y1wiLCBkYXlTdGFydFV0Yyk7XG5cbiAgICAgIGNvbnN0IG5vd1V0YyA9IERhdGVUaW1lLnV0YygpLnRvSVNPKCk7XG4gICAgICBjb25zdCBmaWx0ZXJlZCA9IChhcHBvaW50bWVudHMgPz8gW10pLmZpbHRlcigoYXBwdCkgPT4ge1xuICAgICAgICBpZiAoYXBwdC5zdGF0dXMgIT09IFwicGVuZGluZ19wYXltZW50XCIpIHJldHVybiB0cnVlO1xuICAgICAgICByZXR1cm4gYXBwdC5ob2xkX2V4cGlyZXNfYXRfdXRjICYmIGFwcHQuaG9sZF9leHBpcmVzX2F0X3V0YyA+IG5vd1V0YztcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCBzbG90cyA9IGdlbmVyYXRlU2xvdHMoe1xuICAgICAgICBkYXRlOiBkYXRlSVNPLFxuICAgICAgICB0aW1lWm9uZTogc2V0dGluZ3MudGltZV96b25lLFxuICAgICAgICB3b3JraW5nSG91cnM6IHNldHRpbmdzLndvcmtpbmdfaG91cnNfanNvbiBhcyBhbnksXG4gICAgICAgIHNlcnZpY2VEdXJhdGlvbk1pbnV0ZXM6IHNlcnZpY2UuZGF0YS5kdXJhdGlvbl9taW51dGVzLFxuICAgICAgICBidWZmZXJNaW51dGVzOiBzZXR0aW5ncy5idWZmZXJfbWludXRlcyxcbiAgICAgICAgYXBwb2ludG1lbnRzOiBbLi4uZmlsdGVyZWQsIC4uLihibG9ja3MgPz8gW10pXSxcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIHsgc2xvdHMgfTtcbiAgICB9XG4gICAgY2FzZSBcImNyZWF0ZV9jaGVja291dFwiOiB7XG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjcmVhdGVDaGVja291dFNlc3Npb24oYXJncyk7XG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICByZXR1cm4geyBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiBcIkNoZWNrb3V0IGZhaWxlZC5cIiB9O1xuICAgICAgfVxuICAgIH1cbiAgICBjYXNlIFwiZ2V0X2J1c2luZXNzX2luZm9cIjoge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgbmFtZTogQlVTSU5FU1NfRkFMTEJBQ0submFtZSxcbiAgICAgICAgYWRkcmVzczogc2V0dGluZ3MuYWRkcmVzcyA/PyBCVVNJTkVTU19GQUxMQkFDSy5hZGRyZXNzLFxuICAgICAgICBwaG9uZTogc2V0dGluZ3MucGhvbmUgPz8gQlVTSU5FU1NfRkFMTEJBQ0sucGhvbmUsXG4gICAgICAgIHBob25lRTE2NDogQlVTSU5FU1NfRkFMTEJBQ0sucGhvbmVFMTY0LFxuICAgICAgICBwb2xpY3lUZXh0OiBzZXR0aW5ncy5wb2xpY3lfdGV4dCA/PyBCVVNJTkVTU19GQUxMQkFDSy5wb2xpY3lUZXh0LFxuICAgICAgICB0aW1lWm9uZTogc2V0dGluZ3MudGltZV96b25lID8/IFwiQW1lcmljYS9OZXdfWW9ya1wiLFxuICAgICAgICBob3Vyczogc2V0dGluZ3Mud29ya2luZ19ob3Vyc19qc29uID8/IEJVU0lORVNTX0ZBTExCQUNLLmhvdXJzLFxuICAgICAgICBydWxlczoge1xuICAgICAgICAgIGRlcG9zaXQ6IFwiJDIwIGNoYXJnZWQgaW1tZWRpYXRlbHkgdG8gYm9va1wiLFxuICAgICAgICAgIHJlc2NoZWR1bGU6IFwiQWxsb3dlZCBvbmx5IDcyKyBob3VycyBiZWZvcmVcIixcbiAgICAgICAgICBsYXRlOiBcIjE1KyBtaW51dGVzIGxhdGUgPSBuby1zaG93OyBkZXBvc2l0IGZvcmZlaXRlZFwiLFxuICAgICAgICB9LFxuICAgICAgfTtcbiAgICB9XG4gICAgZGVmYXVsdDpcbiAgICAgIHJldHVybiB7IGVycm9yOiBcIlVua25vd24gdG9vbFwiIH07XG4gIH1cbn07XG5cbmV4cG9ydCBjb25zdCBnZW5lcmF0ZUFzc2lzdGFudFJlcGx5ID0gYXN5bmMgKG1lc3NhZ2VzOiBBc3Npc3RhbnRNZXNzYWdlW10pID0+IHtcbiAgbGV0IGFjdGlvbnM6IEFzc2lzdGFudEFjdGlvbltdID0gW107XG4gIGxldCByZXBseVRleHQgPSBcIlwiO1xuICBsZXQgY29udmVyc2F0aW9uOiBhbnlbXSA9IFsuLi5tZXNzYWdlc107XG5cbiAgZm9yIChsZXQgaSA9IDA7IGkgPCAzOyBpICs9IDEpIHtcbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGNhbGxPcGVuQUkoY29udmVyc2F0aW9uKTtcbiAgICBjb25zdCBtZXNzYWdlID0gcmVzcG9uc2UuY2hvaWNlcz8uWzBdPy5tZXNzYWdlO1xuICAgIGlmICghbWVzc2FnZSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiTm8gYXNzaXN0YW50IHJlc3BvbnNlXCIpO1xuICAgIH1cblxuICAgIGNvbnN0IHRvb2xDYWxscyA9IG1lc3NhZ2UudG9vbF9jYWxscyA/PyBbXTtcbiAgICBpZiAodG9vbENhbGxzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgcmVwbHlUZXh0ID0gbWVzc2FnZS5jb250ZW50ID8/IFwiXCI7XG4gICAgICBicmVhaztcbiAgICB9XG5cbiAgICBjb252ZXJzYXRpb24gPSBbXG4gICAgICAuLi5jb252ZXJzYXRpb24sXG4gICAgICB7XG4gICAgICAgIHJvbGU6IFwiYXNzaXN0YW50XCIsXG4gICAgICAgIGNvbnRlbnQ6IG1lc3NhZ2UuY29udGVudCA/PyBcIlwiLFxuICAgICAgICB0b29sX2NhbGxzOiB0b29sQ2FsbHMsXG4gICAgICB9LFxuICAgIF07XG5cbiAgICBmb3IgKGNvbnN0IGNhbGwgb2YgdG9vbENhbGxzKSB7XG4gICAgICBjb25zdCBhcmdzID0gc2FmZVBhcnNlQXJncyhjYWxsLmZ1bmN0aW9uPy5hcmd1bWVudHMpO1xuICAgICAgY29uc3QgdG9vbFJlc3VsdCA9IGF3YWl0IGhhbmRsZVRvb2woY2FsbC5mdW5jdGlvbi5uYW1lLCBhcmdzKTtcbiAgICAgIGlmIChjYWxsLmZ1bmN0aW9uLm5hbWUgPT09IFwiY3JlYXRlX2NoZWNrb3V0XCIgJiYgdG9vbFJlc3VsdC5jaGVja291dFVybCkge1xuICAgICAgICBhY3Rpb25zLnB1c2goe1xuICAgICAgICAgIHR5cGU6IFwiY2hlY2tvdXRcIixcbiAgICAgICAgICBsYWJlbDogXCJPcGVuIFN0cmlwZSBDaGVja291dFwiLFxuICAgICAgICAgIHVybDogdG9vbFJlc3VsdC5jaGVja291dFVybCxcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICBjb252ZXJzYXRpb24ucHVzaCh7XG4gICAgICAgIHJvbGU6IFwidG9vbFwiLFxuICAgICAgICB0b29sX2NhbGxfaWQ6IGNhbGwuaWQsXG4gICAgICAgIGNvbnRlbnQ6IEpTT04uc3RyaW5naWZ5KHRvb2xSZXN1bHQpLFxuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgaWYgKCFyZXBseVRleHQpIHtcbiAgICByZXBseVRleHQgPSBcIkkgY2FuIGhlbHAgd2l0aCBzZXJ2aWNlcyBhbmQgYXZhaWxhYmlsaXR5LiBXaGF0IHdvdWxkIHlvdSBsaWtlIHRvIGJvb2s/XCI7XG4gIH1cblxuICBpZiAoIWFjdGlvbnMubGVuZ3RoKSB7XG4gICAgY29uc3QgcGhvbmUgPSBCVVNJTkVTU19GQUxMQkFDSy5waG9uZUUxNjQ7XG4gICAgY29uc3QgbG93ZXIgPSByZXBseVRleHQudG9Mb3dlckNhc2UoKTtcbiAgICBpZiAobG93ZXIuaW5jbHVkZXMoXCJ0ZXh0XCIpIHx8IGxvd2VyLmluY2x1ZGVzKFwiY2FsbFwiKSkge1xuICAgICAgYWN0aW9ucyA9IFtcbiAgICAgICAgeyB0eXBlOiBcInRleHRcIiwgbGFiZWw6IFwiVGV4dCBDYXNwZXJcIiwgdXJsOiBgc21zOiR7cGhvbmV9YCB9LFxuICAgICAgICB7IHR5cGU6IFwiY2FsbFwiLCBsYWJlbDogXCJDYWxsIENhc3BlclwiLCB1cmw6IGB0ZWw6JHtwaG9uZX1gIH0sXG4gICAgICBdO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiB7IHJlcGx5VGV4dCwgYWN0aW9ucyB9O1xufTtcbiJdLCJuYW1lcyI6WyJEYXRlVGltZSIsImdldFN1cGFiYXNlQ2xpZW50IiwiZ2VuZXJhdGVTbG90cyIsImZldGNoU2V0dGluZ3MiLCJjcmVhdGVDaGVja291dFNlc3Npb24iLCJCVVNJTkVTU19GQUxMQkFDSyIsIm5hbWUiLCJhZGRyZXNzIiwicGhvbmUiLCJwaG9uZUUxNjQiLCJwb2xpY3lUZXh0IiwiaG91cnMiLCJkYXkiLCJ0b29scyIsInR5cGUiLCJmdW5jdGlvbiIsImRlc2NyaXB0aW9uIiwicGFyYW1ldGVycyIsInByb3BlcnRpZXMiLCJzZXJ2aWNlSWQiLCJkYXRlSVNPIiwicmVxdWlyZWQiLCJzdGFydFRpbWVMb2NhbElTTyIsImZ1bGxOYW1lIiwic21zT3B0SW4iLCJzeXN0ZW1Qcm9tcHQiLCJ0cmltIiwic2FmZVBhcnNlQXJncyIsInJhdyIsIkpTT04iLCJwYXJzZSIsImNhbGxPcGVuQUkiLCJtZXNzYWdlcyIsImFwaUtleSIsInByb2Nlc3MiLCJlbnYiLCJPUEVOQUlfQVBJX0tFWSIsIkVycm9yIiwicmVzcG9uc2UiLCJmZXRjaCIsIm1ldGhvZCIsImhlYWRlcnMiLCJBdXRob3JpemF0aW9uIiwiYm9keSIsInN0cmluZ2lmeSIsIm1vZGVsIiwidGVtcGVyYXR1cmUiLCJyb2xlIiwiY29udGVudCIsIm9rIiwidGV4dCIsImpzb24iLCJoYW5kbGVUb29sIiwiYXJncyIsInN1cGFiYXNlIiwic2V0dGluZ3MiLCJkYXRhIiwiZXJyb3IiLCJmcm9tIiwic2VsZWN0IiwiZXEiLCJvcmRlciIsImFzY2VuZGluZyIsIm1lc3NhZ2UiLCJzZXJ2aWNlcyIsIm1hcCIsInNlcnZpY2UiLCJib29rYWJsZV9vbmxpbmUiLCJwcmljZV9mcm9tIiwic2luZ2xlIiwic2xvdHMiLCJsb2NhbFN0YXJ0IiwiZnJvbUlTTyIsInpvbmUiLCJ0aW1lX3pvbmUiLCJzdGFydE9mIiwibG9jYWxFbmQiLCJlbmRPZiIsImRheVN0YXJ0VXRjIiwidG9VVEMiLCJ0b0lTTyIsImRheUVuZFV0YyIsImFwcG9pbnRtZW50cyIsImx0IiwiZ3QiLCJpbiIsImJsb2NrcyIsIm5vd1V0YyIsInV0YyIsImZpbHRlcmVkIiwiZmlsdGVyIiwiYXBwdCIsInN0YXR1cyIsImhvbGRfZXhwaXJlc19hdF91dGMiLCJkYXRlIiwidGltZVpvbmUiLCJ3b3JraW5nSG91cnMiLCJ3b3JraW5nX2hvdXJzX2pzb24iLCJzZXJ2aWNlRHVyYXRpb25NaW51dGVzIiwiZHVyYXRpb25fbWludXRlcyIsImJ1ZmZlck1pbnV0ZXMiLCJidWZmZXJfbWludXRlcyIsInJlc3VsdCIsInBvbGljeV90ZXh0IiwicnVsZXMiLCJkZXBvc2l0IiwicmVzY2hlZHVsZSIsImxhdGUiLCJnZW5lcmF0ZUFzc2lzdGFudFJlcGx5IiwiYWN0aW9ucyIsInJlcGx5VGV4dCIsImNvbnZlcnNhdGlvbiIsImkiLCJjaG9pY2VzIiwidG9vbENhbGxzIiwidG9vbF9jYWxscyIsImxlbmd0aCIsImNhbGwiLCJhcmd1bWVudHMiLCJ0b29sUmVzdWx0IiwiY2hlY2tvdXRVcmwiLCJwdXNoIiwibGFiZWwiLCJ1cmwiLCJ0b29sX2NhbGxfaWQiLCJpZCIsImxvd2VyIiwidG9Mb3dlckNhc2UiLCJpbmNsdWRlcyJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./lib/server/assistant.ts\n");

/***/ }),

/***/ "(rsc)/./lib/server/checkout.ts":
/*!********************************!*\
  !*** ./lib/server/checkout.ts ***!
  \********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   CheckoutError: () => (/* binding */ CheckoutError),\n/* harmony export */   createCheckoutSession: () => (/* binding */ createCheckoutSession)\n/* harmony export */ });\n/* harmony import */ var luxon__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! luxon */ \"(rsc)/./node_modules/luxon/build/es6/luxon.mjs\");\n/* harmony import */ var _lib_validators__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/lib/validators */ \"(rsc)/./lib/validators.ts\");\n/* harmony import */ var _lib_supabase_client__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/supabase/client */ \"(rsc)/./lib/supabase/client.ts\");\n/* harmony import */ var _lib_server_appointments__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/lib/server/appointments */ \"(rsc)/./lib/server/appointments.ts\");\n/* harmony import */ var _lib_stripe__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/lib/stripe */ \"(rsc)/./lib/stripe.ts\");\n\n\n\n\n\nclass CheckoutError extends Error {\n    constructor(message, status = 400){\n        super(message);\n        this.status = status;\n    }\n}\nconst createCheckoutSession = async (input)=>{\n    const parsed = _lib_validators__WEBPACK_IMPORTED_MODULE_0__.checkoutSchema.safeParse(input);\n    if (!parsed.success) {\n        throw new CheckoutError(\"Invalid request\", 400);\n    }\n    const supabase = (0,_lib_supabase_client__WEBPACK_IMPORTED_MODULE_1__.getSupabaseClient)();\n    const settings = await (0,_lib_server_appointments__WEBPACK_IMPORTED_MODULE_2__.fetchSettings)();\n    const { serviceId, startTimeLocalISO, fullName, phoneE164, smsOptIn } = parsed.data;\n    const serviceResponse = await supabase.from(\"services\").select(\"id, duration_minutes, deposit_amount, price_from\").eq(\"id\", serviceId).eq(\"active\", true).single();\n    if (serviceResponse.error) {\n        throw new CheckoutError(serviceResponse.error.message, 500);\n    }\n    if (serviceResponse.data.price_from) {\n        throw new CheckoutError(\"This service requires direct confirmation. Please text Casper.\", 400);\n    }\n    const startLocal = luxon__WEBPACK_IMPORTED_MODULE_4__.DateTime.fromISO(startTimeLocalISO, {\n        zone: settings.time_zone\n    });\n    if (!startLocal.isValid) {\n        throw new CheckoutError(\"Invalid start time\", 400);\n    }\n    if (startLocal <= luxon__WEBPACK_IMPORTED_MODULE_4__.DateTime.now().setZone(settings.time_zone)) {\n        throw new CheckoutError(\"Start time is in the past\", 400);\n    }\n    const startUtc = startLocal.toUTC();\n    const endUtc = startUtc.plus({\n        minutes: serviceResponse.data.duration_minutes\n    });\n    const { data: existingCustomer } = await supabase.from(\"customers\").select(\"id\").eq(\"phone_e164\", phoneE164).maybeSingle();\n    let customerId = existingCustomer?.id;\n    if (!customerId) {\n        const created = await supabase.from(\"customers\").insert({\n            full_name: fullName,\n            phone_e164: phoneE164,\n            sms_opt_in: smsOptIn\n        }).select(\"id\").single();\n        if (created.error) {\n            throw new CheckoutError(created.error.message, 500);\n        }\n        customerId = created.data.id;\n    } else {\n        await supabase.from(\"customers\").update({\n            full_name: fullName,\n            sms_opt_in: smsOptIn\n        }).eq(\"id\", customerId);\n    }\n    const holdExpiresAt = luxon__WEBPACK_IMPORTED_MODULE_4__.DateTime.utc().plus({\n        minutes: 10\n    });\n    const lateEligibleAt = startUtc.plus({\n        minutes: settings.late_grace_minutes\n    });\n    const rescheduleDeadline = startUtc.minus({\n        hours: settings.reschedule_min_hours\n    });\n    const { data: appointmentId, error: appointmentError } = await supabase.rpc(\"create_pending_appointment\", {\n        p_customer_id: customerId,\n        p_service_id: serviceId,\n        p_start_time_utc: startUtc.toISO(),\n        p_end_time_utc: endUtc.toISO(),\n        p_hold_expires_at_utc: holdExpiresAt.toISO(),\n        p_late_eligible_at_utc: lateEligibleAt.toISO(),\n        p_reschedule_deadline_utc: rescheduleDeadline.toISO(),\n        p_buffer_minutes: settings.buffer_minutes\n    });\n    if (appointmentError) {\n        throw new CheckoutError(appointmentError.message, 409);\n    }\n    const amountCents = Math.round(Number(serviceResponse.data.deposit_amount) * 100);\n    const session = await _lib_stripe__WEBPACK_IMPORTED_MODULE_3__.stripe.checkout.sessions.create({\n        mode: \"payment\",\n        payment_method_types: [\n            \"card\"\n        ],\n        line_items: [\n            {\n                price_data: {\n                    currency: \"usd\",\n                    product_data: {\n                        name: \"Cutz By Casper Deposit\"\n                    },\n                    unit_amount: amountCents\n                },\n                quantity: 1\n            }\n        ],\n        metadata: {\n            appointment_id: appointmentId\n        },\n        success_url: `${process.env.NEXT_PUBLIC_BASE_URL}/success?session_id={CHECKOUT_SESSION_ID}`,\n        cancel_url: `${process.env.NEXT_PUBLIC_BASE_URL}/cancel?appointment_id=${appointmentId}`\n    });\n    if (!session.url) {\n        throw new CheckoutError(\"Stripe session missing URL\", 500);\n    }\n    return {\n        checkoutUrl: session.url\n    };\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QWMsQ0FBQztJQUMxRjtJQUVBLElBQUksQ0FBQ2tCLFFBQVFvQixHQUFHLEVBQUU7UUFDaEIsTUFBTSxJQUFJOUYsY0FBYyw4QkFBOEI7SUFDeEQ7SUFFQSxPQUFPO1FBQUUrRixhQUFhckIsUUFBUW9CLEdBQUc7SUFBQztBQUNwQyxFQUFFIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vY3V0ei1ieS1jYXNwZXIvLi9saWIvc2VydmVyL2NoZWNrb3V0LnRzPzFlMWUiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRGF0ZVRpbWUgfSBmcm9tIFwibHV4b25cIjtcbmltcG9ydCB7IGNoZWNrb3V0U2NoZW1hIH0gZnJvbSBcIkAvbGliL3ZhbGlkYXRvcnNcIjtcbmltcG9ydCB7IGdldFN1cGFiYXNlQ2xpZW50IH0gZnJvbSBcIkAvbGliL3N1cGFiYXNlL2NsaWVudFwiO1xuaW1wb3J0IHsgZmV0Y2hTZXR0aW5ncyB9IGZyb20gXCJAL2xpYi9zZXJ2ZXIvYXBwb2ludG1lbnRzXCI7XG5pbXBvcnQgeyBzdHJpcGUgfSBmcm9tIFwiQC9saWIvc3RyaXBlXCI7XG5cbmV4cG9ydCBjbGFzcyBDaGVja291dEVycm9yIGV4dGVuZHMgRXJyb3Ige1xuICBzdGF0dXM6IG51bWJlcjtcblxuICBjb25zdHJ1Y3RvcihtZXNzYWdlOiBzdHJpbmcsIHN0YXR1cyA9IDQwMCkge1xuICAgIHN1cGVyKG1lc3NhZ2UpO1xuICAgIHRoaXMuc3RhdHVzID0gc3RhdHVzO1xuICB9XG59XG5cbmV4cG9ydCBjb25zdCBjcmVhdGVDaGVja291dFNlc3Npb24gPSBhc3luYyAoaW5wdXQ6IHVua25vd24pID0+IHtcbiAgY29uc3QgcGFyc2VkID0gY2hlY2tvdXRTY2hlbWEuc2FmZVBhcnNlKGlucHV0KTtcbiAgaWYgKCFwYXJzZWQuc3VjY2Vzcykge1xuICAgIHRocm93IG5ldyBDaGVja291dEVycm9yKFwiSW52YWxpZCByZXF1ZXN0XCIsIDQwMCk7XG4gIH1cblxuICBjb25zdCBzdXBhYmFzZSA9IGdldFN1cGFiYXNlQ2xpZW50KCk7XG4gIGNvbnN0IHNldHRpbmdzID0gYXdhaXQgZmV0Y2hTZXR0aW5ncygpO1xuICBjb25zdCB7IHNlcnZpY2VJZCwgc3RhcnRUaW1lTG9jYWxJU08sIGZ1bGxOYW1lLCBwaG9uZUUxNjQsIHNtc09wdEluIH0gPSBwYXJzZWQuZGF0YTtcblxuICBjb25zdCBzZXJ2aWNlUmVzcG9uc2UgPSBhd2FpdCBzdXBhYmFzZVxuICAgIC5mcm9tKFwic2VydmljZXNcIilcbiAgICAuc2VsZWN0KFwiaWQsIGR1cmF0aW9uX21pbnV0ZXMsIGRlcG9zaXRfYW1vdW50LCBwcmljZV9mcm9tXCIpXG4gICAgLmVxKFwiaWRcIiwgc2VydmljZUlkKVxuICAgIC5lcShcImFjdGl2ZVwiLCB0cnVlKVxuICAgIC5zaW5nbGUoKTtcbiAgaWYgKHNlcnZpY2VSZXNwb25zZS5lcnJvcikge1xuICAgIHRocm93IG5ldyBDaGVja291dEVycm9yKHNlcnZpY2VSZXNwb25zZS5lcnJvci5tZXNzYWdlLCA1MDApO1xuICB9XG4gIGlmIChzZXJ2aWNlUmVzcG9uc2UuZGF0YS5wcmljZV9mcm9tKSB7XG4gICAgdGhyb3cgbmV3IENoZWNrb3V0RXJyb3IoXG4gICAgICBcIlRoaXMgc2VydmljZSByZXF1aXJlcyBkaXJlY3QgY29uZmlybWF0aW9uLiBQbGVhc2UgdGV4dCBDYXNwZXIuXCIsXG4gICAgICA0MDBcbiAgICApO1xuICB9XG5cbiAgY29uc3Qgc3RhcnRMb2NhbCA9IERhdGVUaW1lLmZyb21JU08oc3RhcnRUaW1lTG9jYWxJU08sIHsgem9uZTogc2V0dGluZ3MudGltZV96b25lIH0pO1xuICBpZiAoIXN0YXJ0TG9jYWwuaXNWYWxpZCkge1xuICAgIHRocm93IG5ldyBDaGVja291dEVycm9yKFwiSW52YWxpZCBzdGFydCB0aW1lXCIsIDQwMCk7XG4gIH1cbiAgaWYgKHN0YXJ0TG9jYWwgPD0gRGF0ZVRpbWUubm93KCkuc2V0Wm9uZShzZXR0aW5ncy50aW1lX3pvbmUpKSB7XG4gICAgdGhyb3cgbmV3IENoZWNrb3V0RXJyb3IoXCJTdGFydCB0aW1lIGlzIGluIHRoZSBwYXN0XCIsIDQwMCk7XG4gIH1cbiAgY29uc3Qgc3RhcnRVdGMgPSBzdGFydExvY2FsLnRvVVRDKCk7XG4gIGNvbnN0IGVuZFV0YyA9IHN0YXJ0VXRjLnBsdXMoeyBtaW51dGVzOiBzZXJ2aWNlUmVzcG9uc2UuZGF0YS5kdXJhdGlvbl9taW51dGVzIH0pO1xuXG4gIGNvbnN0IHsgZGF0YTogZXhpc3RpbmdDdXN0b21lciB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAuZnJvbShcImN1c3RvbWVyc1wiKVxuICAgIC5zZWxlY3QoXCJpZFwiKVxuICAgIC5lcShcInBob25lX2UxNjRcIiwgcGhvbmVFMTY0KVxuICAgIC5tYXliZVNpbmdsZSgpO1xuXG4gIGxldCBjdXN0b21lcklkID0gZXhpc3RpbmdDdXN0b21lcj8uaWQ7XG4gIGlmICghY3VzdG9tZXJJZCkge1xuICAgIGNvbnN0IGNyZWF0ZWQgPSBhd2FpdCBzdXBhYmFzZVxuICAgICAgLmZyb20oXCJjdXN0b21lcnNcIilcbiAgICAgIC5pbnNlcnQoe1xuICAgICAgICBmdWxsX25hbWU6IGZ1bGxOYW1lLFxuICAgICAgICBwaG9uZV9lMTY0OiBwaG9uZUUxNjQsXG4gICAgICAgIHNtc19vcHRfaW46IHNtc09wdEluLFxuICAgICAgfSlcbiAgICAgIC5zZWxlY3QoXCJpZFwiKVxuICAgICAgLnNpbmdsZSgpO1xuICAgIGlmIChjcmVhdGVkLmVycm9yKSB7XG4gICAgICB0aHJvdyBuZXcgQ2hlY2tvdXRFcnJvcihjcmVhdGVkLmVycm9yLm1lc3NhZ2UsIDUwMCk7XG4gICAgfVxuICAgIGN1c3RvbWVySWQgPSBjcmVhdGVkLmRhdGEuaWQ7XG4gIH0gZWxzZSB7XG4gICAgYXdhaXQgc3VwYWJhc2VcbiAgICAgIC5mcm9tKFwiY3VzdG9tZXJzXCIpXG4gICAgICAudXBkYXRlKHsgZnVsbF9uYW1lOiBmdWxsTmFtZSwgc21zX29wdF9pbjogc21zT3B0SW4gfSlcbiAgICAgIC5lcShcImlkXCIsIGN1c3RvbWVySWQpO1xuICB9XG5cbiAgY29uc3QgaG9sZEV4cGlyZXNBdCA9IERhdGVUaW1lLnV0YygpLnBsdXMoeyBtaW51dGVzOiAxMCB9KTtcbiAgY29uc3QgbGF0ZUVsaWdpYmxlQXQgPSBzdGFydFV0Yy5wbHVzKHsgbWludXRlczogc2V0dGluZ3MubGF0ZV9ncmFjZV9taW51dGVzIH0pO1xuICBjb25zdCByZXNjaGVkdWxlRGVhZGxpbmUgPSBzdGFydFV0Yy5taW51cyh7IGhvdXJzOiBzZXR0aW5ncy5yZXNjaGVkdWxlX21pbl9ob3VycyB9KTtcblxuICBjb25zdCB7IGRhdGE6IGFwcG9pbnRtZW50SWQsIGVycm9yOiBhcHBvaW50bWVudEVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZS5ycGMoXG4gICAgXCJjcmVhdGVfcGVuZGluZ19hcHBvaW50bWVudFwiLFxuICAgIHtcbiAgICAgIHBfY3VzdG9tZXJfaWQ6IGN1c3RvbWVySWQsXG4gICAgICBwX3NlcnZpY2VfaWQ6IHNlcnZpY2VJZCxcbiAgICAgIHBfc3RhcnRfdGltZV91dGM6IHN0YXJ0VXRjLnRvSVNPKCksXG4gICAgICBwX2VuZF90aW1lX3V0YzogZW5kVXRjLnRvSVNPKCksXG4gICAgICBwX2hvbGRfZXhwaXJlc19hdF91dGM6IGhvbGRFeHBpcmVzQXQudG9JU08oKSxcbiAgICAgIHBfbGF0ZV9lbGlnaWJsZV9hdF91dGM6IGxhdGVFbGlnaWJsZUF0LnRvSVNPKCksXG4gICAgICBwX3Jlc2NoZWR1bGVfZGVhZGxpbmVfdXRjOiByZXNjaGVkdWxlRGVhZGxpbmUudG9JU08oKSxcbiAgICAgIHBfYnVmZmVyX21pbnV0ZXM6IHNldHRpbmdzLmJ1ZmZlcl9taW51dGVzLFxuICAgIH1cbiAgKTtcblxuICBpZiAoYXBwb2ludG1lbnRFcnJvcikge1xuICAgIHRocm93IG5ldyBDaGVja291dEVycm9yKGFwcG9pbnRtZW50RXJyb3IubWVzc2FnZSwgNDA5KTtcbiAgfVxuXG4gIGNvbnN0IGFtb3VudENlbnRzID0gTWF0aC5yb3VuZChOdW1iZXIoc2VydmljZVJlc3BvbnNlLmRhdGEuZGVwb3NpdF9hbW91bnQpICogMTAwKTtcbiAgY29uc3Qgc2Vzc2lvbiA9IGF3YWl0IHN0cmlwZS5jaGVja291dC5zZXNzaW9ucy5jcmVhdGUoe1xuICAgIG1vZGU6IFwicGF5bWVudFwiLFxuICAgIHBheW1lbnRfbWV0aG9kX3R5cGVzOiBbXCJjYXJkXCJdLFxuICAgIGxpbmVfaXRlbXM6IFtcbiAgICAgIHtcbiAgICAgICAgcHJpY2VfZGF0YToge1xuICAgICAgICAgIGN1cnJlbmN5OiBcInVzZFwiLFxuICAgICAgICAgIHByb2R1Y3RfZGF0YToge1xuICAgICAgICAgICAgbmFtZTogXCJDdXR6IEJ5IENhc3BlciBEZXBvc2l0XCIsXG4gICAgICAgICAgfSxcbiAgICAgICAgICB1bml0X2Ftb3VudDogYW1vdW50Q2VudHMsXG4gICAgICAgIH0sXG4gICAgICAgIHF1YW50aXR5OiAxLFxuICAgICAgfSxcbiAgICBdLFxuICAgIG1ldGFkYXRhOiB7IGFwcG9pbnRtZW50X2lkOiBhcHBvaW50bWVudElkIH0sXG4gICAgc3VjY2Vzc191cmw6IGAke3Byb2Nlc3MuZW52Lk5FWFRfUFVCTElDX0JBU0VfVVJMfS9zdWNjZXNzP3Nlc3Npb25faWQ9e0NIRUNLT1VUX1NFU1NJT05fSUR9YCxcbiAgICBjYW5jZWxfdXJsOiBgJHtwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19CQVNFX1VSTH0vY2FuY2VsP2FwcG9pbnRtZW50X2lkPSR7YXBwb2ludG1lbnRJZH1gLFxuICB9KTtcblxuICBpZiAoIXNlc3Npb24udXJsKSB7XG4gICAgdGhyb3cgbmV3IENoZWNrb3V0RXJyb3IoXCJTdHJpcGUgc2Vzc2lvbiBtaXNzaW5nIFVSTFwiLCA1MDApO1xuICB9XG5cbiAgcmV0dXJuIHsgY2hlY2tvdXRVcmw6IHNlc3Npb24udXJsIH07XG59O1xuIl0sIm5hbWVzIjpbIkRhdGVUaW1lIiwiY2hlY2tvdXRTY2hlbWEiLCJnZXRTdXBhYmFzZUNsaWVudCIsImZldGNoU2V0dGluZ3MiLCJzdHJpcGUiLCJDaGVja291dEVycm9yIiwiRXJyb3IiLCJjb25zdHJ1Y3RvciIsIm1lc3NhZ2UiLCJzdGF0dXMiLCJjcmVhdGVDaGVja291dFNlc3Npb24iLCJpbnB1dCIsInBhcnNlZCIsInNhZmVQYXJzZSIsInN1Y2Nlc3MiLCJzdXBhYmFzZSIsInNldHRpbmdzIiwic2VydmljZUlkIiwic3RhcnRUaW1lTG9jYWxJU08iLCJmdWxsTmFtZSIsInBob25lRTE2NCIsInNtc09wdEluIiwiZGF0YSIsInNlcnZpY2VSZXNwb25zZSIsImZyb20iLCJzZWxlY3QiLCJlcSIsInNpbmdsZSIsImVycm9yIiwicHJpY2VfZnJvbSIsInN0YXJ0TG9jYWwiLCJmcm9tSVNPIiwiem9uZSIsInRpbWVfem9uZSIsImlzVmFsaWQiLCJub3ciLCJzZXRab25lIiwic3RhcnRVdGMiLCJ0b1VUQyIsImVuZFV0YyIsInBsdXMiLCJtaW51dGVzIiwiZHVyYXRpb25fbWludXRlcyIsImV4aXN0aW5nQ3VzdG9tZXIiLCJtYXliZVNpbmdsZSIsImN1c3RvbWVySWQiLCJpZCIsImNyZWF0ZWQiLCJpbnNlcnQiLCJmdWxsX25hbWUiLCJwaG9uZV9lMTY0Iiwic21zX29wdF9pbiIsInVwZGF0ZSIsImhvbGRFeHBpcmVzQXQiLCJ1dGMiLCJsYXRlRWxpZ2libGVBdCIsImxhdGVfZ3JhY2VfbWludXRlcyIsInJlc2NoZWR1bGVEZWFkbGluZSIsIm1pbnVzIiwiaG91cnMiLCJyZXNjaGVkdWxlX21pbl9ob3VycyIsImFwcG9pbnRtZW50SWQiLCJhcHBvaW50bWVudEVycm9yIiwicnBjIiwicF9jdXN0b21lcl9pZCIsInBfc2VydmljZV9pZCIsInBfc3RhcnRfdGltZV91dGMiLCJ0b0lTTyIsInBfZW5kX3RpbWVfdXRjIiwicF9ob2xkX2V4cGlyZXNfYXRfdXRjIiwicF9sYXRlX2VsaWdpYmxlX2F0X3V0YyIsInBfcmVzY2hlZHVsZV9kZWFkbGluZV91dGMiLCJwX2J1ZmZlcl9taW51dGVzIiwiYnVmZmVyX21pbnV0ZXMiLCJhbW91bnRDZW50cyIsIk1hdGgiLCJyb3VuZCIsIk51bWJlciIsImRlcG9zaXRfYW1vdW50Iiwic2Vzc2lvbiIsImNoZWNrb3V0Iiwic2Vzc2lvbnMiLCJjcmVhdGUiLCJtb2RlIiwicGF5bWVudF9tZXRob2RfdHlwZXMiLCJsaW5lX2l0ZW1zIiwicHJpY2VfZGF0YSIsImN1cnJlbmN5IiwicHJvZHVjdF9kYXRhIiwibmFtZSIsInVuaXRfYW1vdW50IiwicXVhbnRpdHkiLCJtZXRhZGF0YSIsImFwcG9pbnRtZW50X2lkIiwic3VjY2Vzc191cmwiLCJwcm9jZXNzIiwiZW52IiwiTkVYVF9QVUJMSUNfQkFTRV9VUkwiLCJjYW5jZWxfdXJsIiwidXJsIiwiY2hlY2tvdXRVcmwiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./lib/server/checkout.ts\n");

/***/ }),

/***/ "(rsc)/./lib/stripe.ts":
/*!***********************!*\
  !*** ./lib/stripe.ts ***!
  \***********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   stripe: () => (/* binding */ stripe)\n/* harmony export */ });\n/* harmony import */ var stripe__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! stripe */ \"(rsc)/./node_modules/stripe/esm/stripe.esm.node.js\");\n\nconst stripe = new stripe__WEBPACK_IMPORTED_MODULE_0__[\"default\"](process.env.STRIPE_SECRET_KEY ?? \"\", {\n    apiVersion: \"2024-06-20\"\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvc3RyaXBlLnRzIiwibWFwcGluZ3MiOiI7Ozs7O0FBQTRCO0FBRXJCLE1BQU1DLFNBQVMsSUFBSUQsOENBQU1BLENBQUNFLFFBQVFDLEdBQUcsQ0FBQ0MsaUJBQWlCLElBQUksSUFBSTtJQUNwRUMsWUFBWTtBQUNkLEdBQUciLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9jdXR6LWJ5LWNhc3Blci8uL2xpYi9zdHJpcGUudHM/MGUzMyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgU3RyaXBlIGZyb20gXCJzdHJpcGVcIjtcblxuZXhwb3J0IGNvbnN0IHN0cmlwZSA9IG5ldyBTdHJpcGUocHJvY2Vzcy5lbnYuU1RSSVBFX1NFQ1JFVF9LRVkgPz8gXCJcIiwge1xuICBhcGlWZXJzaW9uOiBcIjIwMjQtMDYtMjBcIixcbn0pO1xyXG4iXSwibmFtZXMiOlsiU3RyaXBlIiwic3RyaXBlIiwicHJvY2VzcyIsImVudiIsIlNUUklQRV9TRUNSRVRfS0VZIiwiYXBpVmVyc2lvbiJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./lib/stripe.ts\n");

/***/ }),

/***/ "(rsc)/./lib/supabase/client.ts":
/*!********************************!*\
  !*** ./lib/supabase/client.ts ***!
  \********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   getSupabaseClient: () => (/* binding */ getSupabaseClient)\n/* harmony export */ });\n/* harmony import */ var _supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @supabase/supabase-js */ \"(rsc)/./node_modules/@supabase/supabase-js/dist/index.mjs\");\n\nconst getSupabaseClient = ()=>{\n    const url = \"https://muwsonnheorirnjjzxce.supabase.co\";\n    const anon = \"sb_publishable_R2C1L11GgruQU8BVTZYrug_QTIdPyok\";\n    if (!url || !anon) {\n        throw new Error(\"Missing Supabase env vars. Set NEXT_PUBLIC_SUPABASE_URL and NEXT_PUBLIC_SUPABASE_ANON_KEY in .env.local and restart.\");\n    }\n    return (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__.createClient)(url, anon);\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvc3VwYWJhc2UvY2xpZW50LnRzIiwibWFwcGluZ3MiOiI7Ozs7O0FBQXFEO0FBRzlDLE1BQU1DLG9CQUFvQjtJQUMvQixNQUFNQyxNQUFNQywwQ0FBb0M7SUFDaEQsTUFBTUcsT0FBT0gsZ0RBQXlDO0lBRXRELElBQUksQ0FBQ0QsT0FBTyxDQUFDSSxNQUFNO1FBQ2pCLE1BQU0sSUFBSUUsTUFDUjtJQUVKO0lBRUEsT0FBT1IsbUVBQVlBLENBQVdFLEtBQUtJO0FBQ3JDLEVBQUUiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9jdXR6LWJ5LWNhc3Blci8uL2xpYi9zdXBhYmFzZS9jbGllbnQudHM/NWFiZiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBjcmVhdGVDbGllbnQgfSBmcm9tIFwiQHN1cGFiYXNlL3N1cGFiYXNlLWpzXCI7XG5pbXBvcnQgdHlwZSB7IERhdGFiYXNlIH0gZnJvbSBcIi4uL3R5cGVzXCI7XG5cbmV4cG9ydCBjb25zdCBnZXRTdXBhYmFzZUNsaWVudCA9ICgpID0+IHtcbiAgY29uc3QgdXJsID0gcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfU1VQQUJBU0VfVVJMO1xuICBjb25zdCBhbm9uID0gcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfU1VQQUJBU0VfQU5PTl9LRVk7XG5cbiAgaWYgKCF1cmwgfHwgIWFub24pIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICBcIk1pc3NpbmcgU3VwYWJhc2UgZW52IHZhcnMuIFNldCBORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkwgYW5kIE5FWFRfUFVCTElDX1NVUEFCQVNFX0FOT05fS0VZIGluIC5lbnYubG9jYWwgYW5kIHJlc3RhcnQuXCJcbiAgICApO1xuICB9XG5cbiAgcmV0dXJuIGNyZWF0ZUNsaWVudDxEYXRhYmFzZT4odXJsLCBhbm9uKTtcbn07XG4iXSwibmFtZXMiOlsiY3JlYXRlQ2xpZW50IiwiZ2V0U3VwYWJhc2VDbGllbnQiLCJ1cmwiLCJwcm9jZXNzIiwiZW52IiwiTkVYVF9QVUJMSUNfU1VQQUJBU0VfVVJMIiwiYW5vbiIsIk5FWFRfUFVCTElDX1NVUEFCQVNFX0FOT05fS0VZIiwiRXJyb3IiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./lib/supabase/client.ts\n");

/***/ }),

/***/ "(rsc)/./lib/time.ts":
/*!*********************!*\
  !*** ./lib/time.ts ***!
  \*********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   DEFAULT_TIME_ZONE: () => (/* binding */ DEFAULT_TIME_ZONE),\n/* harmony export */   buildLocalDateTime: () => (/* binding */ buildLocalDateTime),\n/* harmony export */   formatLocal: () => (/* binding */ formatLocal),\n/* harmony export */   getDayOfWeekKey: () => (/* binding */ getDayOfWeekKey),\n/* harmony export */   toLocalISO: () => (/* binding */ toLocalISO),\n/* harmony export */   toUtcISO: () => (/* binding */ toUtcISO)\n/* harmony export */ });\n/* harmony import */ var luxon__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! luxon */ \"(rsc)/./node_modules/luxon/build/es6/luxon.mjs\");\n\nconst DEFAULT_TIME_ZONE = \"America/New_York\";\nconst toUtcISO = (localISO, timeZone)=>{\n    return luxon__WEBPACK_IMPORTED_MODULE_0__.DateTime.fromISO(localISO, {\n        zone: timeZone\n    }).toUTC().toISO();\n};\nconst formatLocal = (utcISO, timeZone)=>{\n    return luxon__WEBPACK_IMPORTED_MODULE_0__.DateTime.fromISO(utcISO, {\n        zone: \"utc\"\n    }).setZone(timeZone).toFormat(\"ccc, LLL d - h:mm a\");\n};\nconst toLocalISO = (utcISO, timeZone)=>{\n    return luxon__WEBPACK_IMPORTED_MODULE_0__.DateTime.fromISO(utcISO, {\n        zone: \"utc\"\n    }).setZone(timeZone).toISO();\n};\nconst getDayOfWeekKey = (localISODate, timeZone)=>{\n    return luxon__WEBPACK_IMPORTED_MODULE_0__.DateTime.fromISO(localISODate, {\n        zone: timeZone\n    }).toFormat(\"cccc\");\n};\nconst buildLocalDateTime = (localDate, time, timeZone)=>{\n    return luxon__WEBPACK_IMPORTED_MODULE_0__.DateTime.fromISO(`${localDate}T${time}`, {\n        zone: timeZone\n    });\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvdGltZS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7O0FBQWlDO0FBRTFCLE1BQU1DLG9CQUFvQixtQkFBbUI7QUFFN0MsTUFBTUMsV0FBVyxDQUFDQyxVQUFrQkM7SUFDekMsT0FBT0osMkNBQVFBLENBQUNLLE9BQU8sQ0FBQ0YsVUFBVTtRQUFFRyxNQUFNRjtJQUFTLEdBQUdHLEtBQUssR0FBR0MsS0FBSztBQUNyRSxFQUFFO0FBRUssTUFBTUMsY0FBYyxDQUFDQyxRQUFnQk47SUFDMUMsT0FBT0osMkNBQVFBLENBQUNLLE9BQU8sQ0FBQ0ssUUFBUTtRQUFFSixNQUFNO0lBQU0sR0FDM0NLLE9BQU8sQ0FBQ1AsVUFDUlEsUUFBUSxDQUFDO0FBQ2QsRUFBRTtBQUVLLE1BQU1DLGFBQWEsQ0FBQ0gsUUFBZ0JOO0lBQ3pDLE9BQU9KLDJDQUFRQSxDQUFDSyxPQUFPLENBQUNLLFFBQVE7UUFBRUosTUFBTTtJQUFNLEdBQzNDSyxPQUFPLENBQUNQLFVBQ1JJLEtBQUs7QUFDVixFQUFFO0FBRUssTUFBTU0sa0JBQWtCLENBQUNDLGNBQXNCWDtJQUNwRCxPQUFPSiwyQ0FBUUEsQ0FBQ0ssT0FBTyxDQUFDVSxjQUFjO1FBQUVULE1BQU1GO0lBQVMsR0FBR1EsUUFBUSxDQUFDO0FBQ3JFLEVBQUU7QUFFSyxNQUFNSSxxQkFBcUIsQ0FDaENDLFdBQ0FDLE1BQ0FkO0lBRUEsT0FBT0osMkNBQVFBLENBQUNLLE9BQU8sQ0FBQyxDQUFDLEVBQUVZLFVBQVUsQ0FBQyxFQUFFQyxLQUFLLENBQUMsRUFBRTtRQUFFWixNQUFNRjtJQUFTO0FBQ25FLEVBQUUiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9jdXR6LWJ5LWNhc3Blci8uL2xpYi90aW1lLnRzPzY4ZTgiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRGF0ZVRpbWUgfSBmcm9tIFwibHV4b25cIjtcblxuZXhwb3J0IGNvbnN0IERFRkFVTFRfVElNRV9aT05FID0gXCJBbWVyaWNhL05ld19Zb3JrXCI7XG5cbmV4cG9ydCBjb25zdCB0b1V0Y0lTTyA9IChsb2NhbElTTzogc3RyaW5nLCB0aW1lWm9uZTogc3RyaW5nKSA9PiB7XG4gIHJldHVybiBEYXRlVGltZS5mcm9tSVNPKGxvY2FsSVNPLCB7IHpvbmU6IHRpbWVab25lIH0pLnRvVVRDKCkudG9JU08oKTtcbn07XG5cbmV4cG9ydCBjb25zdCBmb3JtYXRMb2NhbCA9ICh1dGNJU086IHN0cmluZywgdGltZVpvbmU6IHN0cmluZykgPT4ge1xuICByZXR1cm4gRGF0ZVRpbWUuZnJvbUlTTyh1dGNJU08sIHsgem9uZTogXCJ1dGNcIiB9KVxuICAgIC5zZXRab25lKHRpbWVab25lKVxuICAgIC50b0Zvcm1hdChcImNjYywgTExMIGQgLSBoOm1tIGFcIik7XG59O1xuXG5leHBvcnQgY29uc3QgdG9Mb2NhbElTTyA9ICh1dGNJU086IHN0cmluZywgdGltZVpvbmU6IHN0cmluZykgPT4ge1xuICByZXR1cm4gRGF0ZVRpbWUuZnJvbUlTTyh1dGNJU08sIHsgem9uZTogXCJ1dGNcIiB9KVxuICAgIC5zZXRab25lKHRpbWVab25lKVxuICAgIC50b0lTTygpO1xufTtcblxuZXhwb3J0IGNvbnN0IGdldERheU9mV2Vla0tleSA9IChsb2NhbElTT0RhdGU6IHN0cmluZywgdGltZVpvbmU6IHN0cmluZykgPT4ge1xuICByZXR1cm4gRGF0ZVRpbWUuZnJvbUlTTyhsb2NhbElTT0RhdGUsIHsgem9uZTogdGltZVpvbmUgfSkudG9Gb3JtYXQoXCJjY2NjXCIpO1xufTtcblxuZXhwb3J0IGNvbnN0IGJ1aWxkTG9jYWxEYXRlVGltZSA9IChcbiAgbG9jYWxEYXRlOiBzdHJpbmcsXG4gIHRpbWU6IHN0cmluZyxcbiAgdGltZVpvbmU6IHN0cmluZ1xuKSA9PiB7XG4gIHJldHVybiBEYXRlVGltZS5mcm9tSVNPKGAke2xvY2FsRGF0ZX1UJHt0aW1lfWAsIHsgem9uZTogdGltZVpvbmUgfSk7XG59O1xyXG4iXSwibmFtZXMiOlsiRGF0ZVRpbWUiLCJERUZBVUxUX1RJTUVfWk9ORSIsInRvVXRjSVNPIiwibG9jYWxJU08iLCJ0aW1lWm9uZSIsImZyb21JU08iLCJ6b25lIiwidG9VVEMiLCJ0b0lTTyIsImZvcm1hdExvY2FsIiwidXRjSVNPIiwic2V0Wm9uZSIsInRvRm9ybWF0IiwidG9Mb2NhbElTTyIsImdldERheU9mV2Vla0tleSIsImxvY2FsSVNPRGF0ZSIsImJ1aWxkTG9jYWxEYXRlVGltZSIsImxvY2FsRGF0ZSIsInRpbWUiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./lib/time.ts\n");

/***/ }),

/***/ "(rsc)/./lib/validators.ts":
/*!***************************!*\
  !*** ./lib/validators.ts ***!
  \***************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   checkoutSchema: () => (/* binding */ checkoutSchema),\n/* harmony export */   rescheduleSchema: () => (/* binding */ rescheduleSchema),\n/* harmony export */   serviceSchema: () => (/* binding */ serviceSchema),\n/* harmony export */   settingsSchema: () => (/* binding */ settingsSchema),\n/* harmony export */   statusSchema: () => (/* binding */ statusSchema)\n/* harmony export */ });\n/* harmony import */ var zod__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! zod */ \"(rsc)/./node_modules/zod/v3/types.js\");\n\nconst checkoutSchema = zod__WEBPACK_IMPORTED_MODULE_0__.object({\n    serviceId: zod__WEBPACK_IMPORTED_MODULE_0__.string().uuid(),\n    startTimeLocalISO: zod__WEBPACK_IMPORTED_MODULE_0__.string().min(10),\n    fullName: zod__WEBPACK_IMPORTED_MODULE_0__.string().min(2),\n    phoneE164: zod__WEBPACK_IMPORTED_MODULE_0__.string().regex(/^\\+[1-9]\\d{7,14}$/),\n    smsOptIn: zod__WEBPACK_IMPORTED_MODULE_0__.boolean()\n});\nconst rescheduleSchema = zod__WEBPACK_IMPORTED_MODULE_0__.object({\n    startTimeLocalISO: zod__WEBPACK_IMPORTED_MODULE_0__.string().min(10)\n});\nconst statusSchema = zod__WEBPACK_IMPORTED_MODULE_0__.object({\n    status: zod__WEBPACK_IMPORTED_MODULE_0__[\"enum\"]([\n        \"completed\",\n        \"cancelled\",\n        \"no_show\"\n    ])\n});\nconst serviceSchema = zod__WEBPACK_IMPORTED_MODULE_0__.object({\n    name: zod__WEBPACK_IMPORTED_MODULE_0__.string().min(2),\n    duration_minutes: zod__WEBPACK_IMPORTED_MODULE_0__.number().min(15),\n    price_display: zod__WEBPACK_IMPORTED_MODULE_0__.string().min(1),\n    deposit_amount: zod__WEBPACK_IMPORTED_MODULE_0__.number().min(0),\n    active: zod__WEBPACK_IMPORTED_MODULE_0__.boolean()\n});\nconst settingsSchema = zod__WEBPACK_IMPORTED_MODULE_0__.object({\n    id: zod__WEBPACK_IMPORTED_MODULE_0__.string().uuid().optional(),\n    time_zone: zod__WEBPACK_IMPORTED_MODULE_0__.string().min(1),\n    buffer_minutes: zod__WEBPACK_IMPORTED_MODULE_0__.number().min(0),\n    working_hours_json: zod__WEBPACK_IMPORTED_MODULE_0__.record(zod__WEBPACK_IMPORTED_MODULE_0__.array(zod__WEBPACK_IMPORTED_MODULE_0__.object({\n        start: zod__WEBPACK_IMPORTED_MODULE_0__.string(),\n        end: zod__WEBPACK_IMPORTED_MODULE_0__.string()\n    })))\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvdmFsaWRhdG9ycy50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFBd0I7QUFFakIsTUFBTUMsaUJBQWlCRCx1Q0FBUSxDQUFDO0lBQ3JDRyxXQUFXSCx1Q0FBUSxHQUFHSyxJQUFJO0lBQzFCQyxtQkFBbUJOLHVDQUFRLEdBQUdPLEdBQUcsQ0FBQztJQUNsQ0MsVUFBVVIsdUNBQVEsR0FBR08sR0FBRyxDQUFDO0lBQ3pCRSxXQUFXVCx1Q0FBUSxHQUFHVSxLQUFLLENBQUM7SUFDNUJDLFVBQVVYLHdDQUFTO0FBQ3JCLEdBQUc7QUFFSSxNQUFNYSxtQkFBbUJiLHVDQUFRLENBQUM7SUFDdkNNLG1CQUFtQk4sdUNBQVEsR0FBR08sR0FBRyxDQUFDO0FBQ3BDLEdBQUc7QUFFSSxNQUFNTyxlQUFlZCx1Q0FBUSxDQUFDO0lBQ25DZSxRQUFRZix3Q0FBTSxDQUFDO1FBQUM7UUFBYTtRQUFhO0tBQVU7QUFDdEQsR0FBRztBQUVJLE1BQU1pQixnQkFBZ0JqQix1Q0FBUSxDQUFDO0lBQ3BDa0IsTUFBTWxCLHVDQUFRLEdBQUdPLEdBQUcsQ0FBQztJQUNyQlksa0JBQWtCbkIsdUNBQVEsR0FBR08sR0FBRyxDQUFDO0lBQ2pDYyxlQUFlckIsdUNBQVEsR0FBR08sR0FBRyxDQUFDO0lBQzlCZSxnQkFBZ0J0Qix1Q0FBUSxHQUFHTyxHQUFHLENBQUM7SUFDL0JnQixRQUFRdkIsd0NBQVM7QUFDbkIsR0FBRztBQUVJLE1BQU13QixpQkFBaUJ4Qix1Q0FBUSxDQUFDO0lBQ3JDeUIsSUFBSXpCLHVDQUFRLEdBQUdLLElBQUksR0FBR3FCLFFBQVE7SUFDOUJDLFdBQVczQix1Q0FBUSxHQUFHTyxHQUFHLENBQUM7SUFDMUJxQixnQkFBZ0I1Qix1Q0FBUSxHQUFHTyxHQUFHLENBQUM7SUFDL0JzQixvQkFBb0I3Qix1Q0FBUSxDQUFDQSxzQ0FBTyxDQUFDQSx1Q0FBUSxDQUFDO1FBQUVnQyxPQUFPaEMsdUNBQVE7UUFBSWlDLEtBQUtqQyx1Q0FBUTtJQUFHO0FBQ3JGLEdBQUciLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9jdXR6LWJ5LWNhc3Blci8uL2xpYi92YWxpZGF0b3JzLnRzPzU2YjAiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgeiB9IGZyb20gXCJ6b2RcIjtcblxuZXhwb3J0IGNvbnN0IGNoZWNrb3V0U2NoZW1hID0gei5vYmplY3Qoe1xuICBzZXJ2aWNlSWQ6IHouc3RyaW5nKCkudXVpZCgpLFxuICBzdGFydFRpbWVMb2NhbElTTzogei5zdHJpbmcoKS5taW4oMTApLFxuICBmdWxsTmFtZTogei5zdHJpbmcoKS5taW4oMiksXG4gIHBob25lRTE2NDogei5zdHJpbmcoKS5yZWdleCgvXlxcK1sxLTldXFxkezcsMTR9JC8pLFxuICBzbXNPcHRJbjogei5ib29sZWFuKCksXG59KTtcblxuZXhwb3J0IGNvbnN0IHJlc2NoZWR1bGVTY2hlbWEgPSB6Lm9iamVjdCh7XG4gIHN0YXJ0VGltZUxvY2FsSVNPOiB6LnN0cmluZygpLm1pbigxMCksXG59KTtcblxuZXhwb3J0IGNvbnN0IHN0YXR1c1NjaGVtYSA9IHoub2JqZWN0KHtcbiAgc3RhdHVzOiB6LmVudW0oW1wiY29tcGxldGVkXCIsIFwiY2FuY2VsbGVkXCIsIFwibm9fc2hvd1wiXSksXG59KTtcblxuZXhwb3J0IGNvbnN0IHNlcnZpY2VTY2hlbWEgPSB6Lm9iamVjdCh7XG4gIG5hbWU6IHouc3RyaW5nKCkubWluKDIpLFxuICBkdXJhdGlvbl9taW51dGVzOiB6Lm51bWJlcigpLm1pbigxNSksXG4gIHByaWNlX2Rpc3BsYXk6IHouc3RyaW5nKCkubWluKDEpLFxuICBkZXBvc2l0X2Ftb3VudDogei5udW1iZXIoKS5taW4oMCksXG4gIGFjdGl2ZTogei5ib29sZWFuKCksXG59KTtcblxuZXhwb3J0IGNvbnN0IHNldHRpbmdzU2NoZW1hID0gei5vYmplY3Qoe1xuICBpZDogei5zdHJpbmcoKS51dWlkKCkub3B0aW9uYWwoKSxcbiAgdGltZV96b25lOiB6LnN0cmluZygpLm1pbigxKSxcbiAgYnVmZmVyX21pbnV0ZXM6IHoubnVtYmVyKCkubWluKDApLFxuICB3b3JraW5nX2hvdXJzX2pzb246IHoucmVjb3JkKHouYXJyYXkoei5vYmplY3QoeyBzdGFydDogei5zdHJpbmcoKSwgZW5kOiB6LnN0cmluZygpIH0pKSksXG59KTtcbiJdLCJuYW1lcyI6WyJ6IiwiY2hlY2tvdXRTY2hlbWEiLCJvYmplY3QiLCJzZXJ2aWNlSWQiLCJzdHJpbmciLCJ1dWlkIiwic3RhcnRUaW1lTG9jYWxJU08iLCJtaW4iLCJmdWxsTmFtZSIsInBob25lRTE2NCIsInJlZ2V4Iiwic21zT3B0SW4iLCJib29sZWFuIiwicmVzY2hlZHVsZVNjaGVtYSIsInN0YXR1c1NjaGVtYSIsInN0YXR1cyIsImVudW0iLCJzZXJ2aWNlU2NoZW1hIiwibmFtZSIsImR1cmF0aW9uX21pbnV0ZXMiLCJudW1iZXIiLCJwcmljZV9kaXNwbGF5IiwiZGVwb3NpdF9hbW91bnQiLCJhY3RpdmUiLCJzZXR0aW5nc1NjaGVtYSIsImlkIiwib3B0aW9uYWwiLCJ0aW1lX3pvbmUiLCJidWZmZXJfbWludXRlcyIsIndvcmtpbmdfaG91cnNfanNvbiIsInJlY29yZCIsImFycmF5Iiwic3RhcnQiLCJlbmQiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./lib/validators.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next","vendor-chunks/@supabase","vendor-chunks/luxon","vendor-chunks/stripe","vendor-chunks/zod","vendor-chunks/qs","vendor-chunks/object-inspect","vendor-chunks/tslib","vendor-chunks/iceberg-js","vendor-chunks/get-intrinsic","vendor-chunks/side-channel-list","vendor-chunks/side-channel-weakmap","vendor-chunks/has-symbols","vendor-chunks/function-bind","vendor-chunks/side-channel-map","vendor-chunks/side-channel","vendor-chunks/get-proto","vendor-chunks/call-bind-apply-helpers","vendor-chunks/dunder-proto","vendor-chunks/math-intrinsics","vendor-chunks/call-bound","vendor-chunks/es-errors","vendor-chunks/gopd","vendor-chunks/es-define-property","vendor-chunks/hasown","vendor-chunks/es-object-atoms"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fassistant%2Froute&page=%2Fapi%2Fassistant%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fassistant%2Froute.ts&appDir=C%3A%5CUsers%5Cfrank%5CDesktop%5CCutz-By-Casper%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Cfrank%5CDesktop%5CCutz-By-Casper&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();